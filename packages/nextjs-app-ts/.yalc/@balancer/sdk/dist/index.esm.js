import{Interface as t,Indexed as e,checkResultErrors as n}from"@ethersproject/abi";import i from"isomorphic-fetch";import{GraphQLClient as r,gql as s}from"graphql-request";import o from"async-retry";import a from"await-timeout";import{getAddress as l,getContractAddress as h}from"@ethersproject/address";import u from"decimal.js-light";var p=[{inputs:[{internalType:"contract IVault",name:"_vault",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[{internalType:"address[]",name:"poolAddresses",type:"address[]"}],name:"getAmpForPools",outputs:[{internalType:"uint256[]",name:"",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address[]",name:"poolAddresses",type:"address[]"}],name:"getNormalizedWeightsForPools",outputs:[{internalType:"uint256[][]",name:"",type:"uint256[][]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32[]",name:"poolIds",type:"bytes32[]"},{components:[{internalType:"bool",name:"loadTokenBalanceUpdatesAfterBlock",type:"bool"},{internalType:"bool",name:"loadTotalSupply",type:"bool"},{internalType:"bool",name:"loadSwapFees",type:"bool"},{internalType:"bool",name:"loadLinearWrappedTokenRates",type:"bool"},{internalType:"bool",name:"loadNormalizedWeights",type:"bool"},{internalType:"bool",name:"loadScalingFactors",type:"bool"},{internalType:"bool",name:"loadAmps",type:"bool"},{internalType:"uint256",name:"blockNumber",type:"uint256"},{internalType:"enum TotalSupplyType[]",name:"totalSupplyTypes",type:"uint8[]"},{internalType:"enum SwapFeeType[]",name:"swapFeeTypes",type:"uint8[]"},{internalType:"uint256[]",name:"linearPoolIdxs",type:"uint256[]"},{internalType:"uint256[]",name:"weightedPoolIdxs",type:"uint256[]"},{internalType:"uint256[]",name:"scalingFactorPoolIdxs",type:"uint256[]"},{internalType:"uint256[]",name:"ampPoolIdxs",type:"uint256[]"}],internalType:"struct SorPoolDataQueryConfig",name:"config",type:"tuple"}],name:"getPoolData",outputs:[{internalType:"uint256[][]",name:"balances",type:"uint256[][]"},{internalType:"uint256[]",name:"totalSupplies",type:"uint256[]"},{internalType:"uint256[]",name:"swapFees",type:"uint256[]"},{internalType:"uint256[]",name:"linearWrappedTokenRates",type:"uint256[]"},{internalType:"uint256[][]",name:"weights",type:"uint256[][]"},{internalType:"uint256[][]",name:"scalingFactors",type:"uint256[][]"},{internalType:"uint256[]",name:"amps",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32[]",name:"poolIds",type:"bytes32[]"},{internalType:"uint256",name:"blockNumber",type:"uint256"}],name:"getPoolTokenBalancesWithUpdatesAfterBlock",outputs:[{internalType:"uint256[][]",name:"",type:"uint256[][]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address[]",name:"poolAddresses",type:"address[]"}],name:"getScalingFactorsForPools",outputs:[{internalType:"uint256[][]",name:"",type:"uint256[][]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address[]",name:"poolAddresses",type:"address[]"},{internalType:"enum SwapFeeType[]",name:"swapFeeTypes",type:"uint8[]"}],name:"getSwapFeePercentageForPools",outputs:[{internalType:"uint256[]",name:"",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address[]",name:"poolAddresses",type:"address[]"},{internalType:"enum TotalSupplyType[]",name:"totalSupplyTypes",type:"uint8[]"}],name:"getTotalSupplyForPools",outputs:[{internalType:"uint256[]",name:"",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address[]",name:"poolAddresses",type:"address[]"}],name:"getWrappedTokenRateForLinearPools",outputs:[{internalType:"uint256[]",name:"",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[],name:"vault",outputs:[{internalType:"contract IVault",name:"",type:"address"}],stateMutability:"view",type:"function"}];class d{constructor(t,e,n,i,r,s,o){if(this.chainId=t,this.address=e.toLowerCase(),this.decimals=n,this.symbol=i,this.name=r,this.isNative=o||!1,s)this.wrapped=s.toLowerCase();else{if(this.isNative)throw new Error("Native assets must have a wrapped address");this.wrapped=e.toLowerCase()}}isEqual(t){return this.chainId===t.chainId&&this.address===t.address}}const c="0x0000000000000000000000000000000000000000",m=5192296858534827628530496329220095n,f=2596148429267413814265248164610048n,g=31536000n;var y;!function(t){t[t.MAINNET=1]="MAINNET",t[t.GOERLI=5]="GOERLI",t[t.POLYGON=137]="POLYGON",t[t.ARBITRUM_ONE=42161]="ARBITRUM_ONE"}(y||(y={}));const w={[y.MAINNET]:"https://api.thegraph.com/subgraphs/name/balancer-labs/balancer-v2",[y.GOERLI]:"https://api.thegraph.com/subgraphs/name/balancer-labs/balancer-goerli-v2",[y.POLYGON]:"https://api.thegraph.com/subgraphs/name/balancer-labs/balancer-polygon-prune-v2",[y.ARBITRUM_ONE]:"https://api.thegraph.com/subgraphs/name/balancer-labs/balancer-arbitrum-v2"},v={[y.MAINNET]:new d(y.MAINNET,"0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE",18,"ETH","Ether","0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2",!0),[y.GOERLI]:new d(y.GOERLI,c,18,"ETH","Ether"),[y.POLYGON]:new d(y.POLYGON,c,18,"MATIC","Matic")},T=v[y.MAINNET],b={sender:c,recipient:c,fromInternalBalance:!1,toInternalBalance:!1},E="0x";let M=!1,k=!1;const I={debug:1,default:2,info:2,warning:3,error:4,off:5};let P=I.default,x=null;const _=function(){try{const t=[];if(["NFD","NFC","NFKD","NFKC"].forEach((e=>{try{if("test"!=="test".normalize(e))throw new Error("bad normalize")}catch(n){t.push(e)}})),t.length)throw new Error("missing "+t.join(", "));if(String.fromCharCode(233).normalize("NFD")!==String.fromCharCode(101,769))throw new Error("broken implementation")}catch(t){return t.message}return null}();var A,N;!function(t){t.DEBUG="DEBUG",t.INFO="INFO",t.WARNING="WARNING",t.ERROR="ERROR",t.OFF="OFF"}(A||(A={})),function(t){t.UNKNOWN_ERROR="UNKNOWN_ERROR",t.NOT_IMPLEMENTED="NOT_IMPLEMENTED",t.UNSUPPORTED_OPERATION="UNSUPPORTED_OPERATION",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.TIMEOUT="TIMEOUT",t.BUFFER_OVERRUN="BUFFER_OVERRUN",t.NUMERIC_FAULT="NUMERIC_FAULT",t.MISSING_NEW="MISSING_NEW",t.INVALID_ARGUMENT="INVALID_ARGUMENT",t.MISSING_ARGUMENT="MISSING_ARGUMENT",t.UNEXPECTED_ARGUMENT="UNEXPECTED_ARGUMENT",t.CALL_EXCEPTION="CALL_EXCEPTION",t.INSUFFICIENT_FUNDS="INSUFFICIENT_FUNDS",t.NONCE_EXPIRED="NONCE_EXPIRED",t.REPLACEMENT_UNDERPRICED="REPLACEMENT_UNDERPRICED",t.UNPREDICTABLE_GAS_LIMIT="UNPREDICTABLE_GAS_LIMIT",t.TRANSACTION_REPLACED="TRANSACTION_REPLACED",t.ACTION_REJECTED="ACTION_REJECTED"}(N||(N={}));const F="0123456789abcdef";class O{constructor(t){Object.defineProperty(this,"version",{enumerable:!0,value:t,writable:!1})}_log(t,e){const n=t.toLowerCase();null==I[n]&&this.throwArgumentError("invalid log level name","logLevel",t),P>I[n]||console.log.apply(console,e)}debug(...t){this._log(O.levels.DEBUG,t)}info(...t){this._log(O.levels.INFO,t)}warn(...t){this._log(O.levels.WARNING,t)}makeError(t,e,n){if(k)return this.makeError("censored error",e,{});e||(e=O.errors.UNKNOWN_ERROR),n||(n={});const i=[];Object.keys(n).forEach((t=>{const e=n[t];try{if(e instanceof Uint8Array){let n="";for(let t=0;t<e.length;t++)n+=F[e[t]>>4],n+=F[15&e[t]];i.push(t+"=Uint8Array(0x"+n+")")}else i.push(t+"="+JSON.stringify(e))}catch(e){i.push(t+"="+JSON.stringify(n[t].toString()))}})),i.push(`code=${e}`),i.push(`version=${this.version}`);const r=t;let s="";switch(e){case N.NUMERIC_FAULT:{s="NUMERIC_FAULT";const e=t;switch(e){case"overflow":case"underflow":case"division-by-zero":s+="-"+e;break;case"negative-power":case"negative-width":s+="-unsupported";break;case"unbound-bitwise-result":s+="-unbound-result"}break}case N.CALL_EXCEPTION:case N.INSUFFICIENT_FUNDS:case N.MISSING_NEW:case N.NONCE_EXPIRED:case N.REPLACEMENT_UNDERPRICED:case N.TRANSACTION_REPLACED:case N.UNPREDICTABLE_GAS_LIMIT:s=e}s&&(t+=" [ See: https://links.ethers.org/v5-errors-"+s+" ]"),i.length&&(t+=" ("+i.join(", ")+")");const o=new Error(t);return o.reason=r,o.code=e,Object.keys(n).forEach((function(t){o[t]=n[t]})),o}throwError(t,e,n){throw this.makeError(t,e,n)}throwArgumentError(t,e,n){return this.throwError(t,O.errors.INVALID_ARGUMENT,{argument:e,value:n})}assert(t,e,n,i){t||this.throwError(e,n,i)}assertArgument(t,e,n,i){t||this.throwArgumentError(e,n,i)}checkNormalize(t){_&&this.throwError("platform missing String.prototype.normalize",O.errors.UNSUPPORTED_OPERATION,{operation:"String.prototype.normalize",form:_})}checkSafeUint53(t,e){"number"==typeof t&&(null==e&&(e="value not safe"),(t<0||t>=9007199254740991)&&this.throwError(e,O.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"out-of-safe-range",value:t}),t%1&&this.throwError(e,O.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"non-integer",value:t}))}checkArgumentCount(t,e,n){n=n?": "+n:"",t<e&&this.throwError("missing argument"+n,O.errors.MISSING_ARGUMENT,{count:t,expectedCount:e}),t>e&&this.throwError("too many arguments"+n,O.errors.UNEXPECTED_ARGUMENT,{count:t,expectedCount:e})}checkNew(t,e){t!==Object&&null!=t||this.throwError("missing new",O.errors.MISSING_NEW,{name:e.name})}checkAbstract(t,e){t===e?this.throwError("cannot instantiate abstract class "+JSON.stringify(e.name)+" directly; use a sub-class",O.errors.UNSUPPORTED_OPERATION,{name:t.name,operation:"new"}):t!==Object&&null!=t||this.throwError("missing new",O.errors.MISSING_NEW,{name:e.name})}static globalLogger(){return x||(x=new O("logger/5.7.0")),x}static setCensorship(t,e){if(!t&&e&&this.globalLogger().throwError("cannot permanently disable censorship",O.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"}),M){if(!t)return;this.globalLogger().throwError("error censorship permanent",O.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"})}k=!!t,M=!!e}static setLogLevel(t){const e=I[t.toLowerCase()];null!=e?P=e:O.globalLogger().warn("invalid log level - "+t)}static from(t){return new O(t)}}O.errors=N,O.levels=A;const S=new O("bytes/5.7.0");function R(t){return!!t.toHexString}function B(t){return t.slice||(t.slice=function(){const e=Array.prototype.slice.call(arguments);return B(new Uint8Array(Array.prototype.slice.apply(t,e)))}),t}function U(t){return"number"==typeof t&&t==t&&t%1==0}function D(t){if(null==t)return!1;if(t.constructor===Uint8Array)return!0;if("string"==typeof t)return!1;if(!U(t.length)||t.length<0)return!1;for(let e=0;e<t.length;e++){const n=t[e];if(!U(n)||n<0||n>=256)return!1}return!0}function L(t,e){if(e||(e={}),"number"==typeof t){S.checkSafeUint53(t,"invalid arrayify value");const e=[];for(;t;)e.unshift(255&t),t=parseInt(String(t/256));return 0===e.length&&e.push(0),B(new Uint8Array(e))}if(e.allowMissingPrefix&&"string"==typeof t&&"0x"!==t.substring(0,2)&&(t="0x"+t),R(t)&&(t=t.toHexString()),C(t)){let n=t.substring(2);n.length%2&&("left"===e.hexPad?n="0"+n:"right"===e.hexPad?n+="0":S.throwArgumentError("hex data is odd-length","value",t));const i=[];for(let t=0;t<n.length;t+=2)i.push(parseInt(n.substring(t,t+2),16));return B(new Uint8Array(i))}return D(t)?B(new Uint8Array(t)):S.throwArgumentError("invalid arrayify value","value",t)}function C(t,e){return!("string"!=typeof t||!t.match(/^0x[0-9A-Fa-f]*$/))&&(!e||t.length===2+2*e)}const G="0123456789abcdef";function q(t,e){if(e||(e={}),"number"==typeof t){S.checkSafeUint53(t,"invalid hexlify value");let e="";for(;t;)e=G[15&t]+e,t=Math.floor(t/16);return e.length?(e.length%2&&(e="0"+e),"0x"+e):"0x00"}if("bigint"==typeof t)return(t=t.toString(16)).length%2?"0x0"+t:"0x"+t;if(e.allowMissingPrefix&&"string"==typeof t&&"0x"!==t.substring(0,2)&&(t="0x"+t),R(t))return t.toHexString();if(C(t))return t.length%2&&("left"===e.hexPad?t="0x0"+t.substring(2):"right"===e.hexPad?t+="0":S.throwArgumentError("hex data is odd-length","value",t)),t.toLowerCase();if(D(t)){let e="0x";for(let n=0;n<t.length;n++){let i=t[n];e+=G[(240&i)>>4]+G[15&i]}return e}return S.throwArgumentError("invalid hexlify value","value",t)}function W(t,e){for("string"!=typeof t?t=q(t):C(t)||S.throwArgumentError("invalid hex string","value",t),t.length>2*e+2&&S.throwArgumentError("value out of range","value",arguments[1]);t.length<2*e+2;)t="0x0"+t.substring(2);return t}var z={exports:{}};!function(t,e){function n(t,e){if(!t)throw new Error(e||"Assertion failed")}function i(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}function r(t,e,n){if(r.isBN(t))return t;this.negative=0,this.words=null,this.length=0,this.red=null,null!==t&&("le"!==e&&"be"!==e||(n=e,e=10),this._init(t||0,e||10,n||"be"))}var s;"object"==typeof t?t.exports=r:e.BN=r,r.BN=r,r.wordSize=26;try{s="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:require("buffer").Buffer}catch(t){}function o(t,e){var i=t.charCodeAt(e);return i>=48&&i<=57?i-48:i>=65&&i<=70?i-55:i>=97&&i<=102?i-87:void n(!1,"Invalid character in "+t)}function a(t,e,n){var i=o(t,n);return n-1>=e&&(i|=o(t,n-1)<<4),i}function l(t,e,i,r){for(var s=0,o=0,a=Math.min(t.length,i),l=e;l<a;l++){var h=t.charCodeAt(l)-48;s*=r,o=h>=49?h-49+10:h>=17?h-17+10:h,n(h>=0&&o<r,"Invalid character"),s+=o}return s}function h(t,e){t.words=e.words,t.length=e.length,t.negative=e.negative,t.red=e.red}if(r.isBN=function(t){return t instanceof r||null!==t&&"object"==typeof t&&t.constructor.wordSize===r.wordSize&&Array.isArray(t.words)},r.max=function(t,e){return t.cmp(e)>0?t:e},r.min=function(t,e){return t.cmp(e)<0?t:e},r.prototype._init=function(t,e,i){if("number"==typeof t)return this._initNumber(t,e,i);if("object"==typeof t)return this._initArray(t,e,i);"hex"===e&&(e=16),n(e===(0|e)&&e>=2&&e<=36);var r=0;"-"===(t=t.toString().replace(/\s+/g,""))[0]&&(r++,this.negative=1),r<t.length&&(16===e?this._parseHex(t,r,i):(this._parseBase(t,e,r),"le"===i&&this._initArray(this.toArray(),e,i)))},r.prototype._initNumber=function(t,e,i){t<0&&(this.negative=1,t=-t),t<67108864?(this.words=[67108863&t],this.length=1):t<4503599627370496?(this.words=[67108863&t,t/67108864&67108863],this.length=2):(n(t<9007199254740992),this.words=[67108863&t,t/67108864&67108863,1],this.length=3),"le"===i&&this._initArray(this.toArray(),e,i)},r.prototype._initArray=function(t,e,i){if(n("number"==typeof t.length),t.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(t.length/3),this.words=new Array(this.length);for(var r=0;r<this.length;r++)this.words[r]=0;var s,o,a=0;if("be"===i)for(r=t.length-1,s=0;r>=0;r-=3)o=t[r]|t[r-1]<<8|t[r-2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);else if("le"===i)for(r=0,s=0;r<t.length;r+=3)o=t[r]|t[r+1]<<8|t[r+2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);return this._strip()},r.prototype._parseHex=function(t,e,n){this.length=Math.ceil((t.length-e)/6),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var r,s=0,o=0;if("be"===n)for(i=t.length-1;i>=e;i-=2)r=a(t,e,i)<<s,this.words[o]|=67108863&r,s>=18?(s-=18,o+=1,this.words[o]|=r>>>26):s+=8;else for(i=(t.length-e)%2==0?e+1:e;i<t.length;i+=2)r=a(t,e,i)<<s,this.words[o]|=67108863&r,s>=18?(s-=18,o+=1,this.words[o]|=r>>>26):s+=8;this._strip()},r.prototype._parseBase=function(t,e,n){this.words=[0],this.length=1;for(var i=0,r=1;r<=67108863;r*=e)i++;i--,r=r/e|0;for(var s=t.length-n,o=s%i,a=Math.min(s,s-o)+n,h=0,u=n;u<a;u+=i)h=l(t,u,u+i,e),this.imuln(r),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h);if(0!==o){var p=1;for(h=l(t,u,t.length,e),u=0;u<o;u++)p*=e;this.imuln(p),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h)}this._strip()},r.prototype.copy=function(t){t.words=new Array(this.length);for(var e=0;e<this.length;e++)t.words[e]=this.words[e];t.length=this.length,t.negative=this.negative,t.red=this.red},r.prototype._move=function(t){h(t,this)},r.prototype.clone=function(){var t=new r(null);return this.copy(t),t},r.prototype._expand=function(t){for(;this.length<t;)this.words[this.length++]=0;return this},r.prototype._strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},r.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},"undefined"!=typeof Symbol&&"function"==typeof Symbol.for)try{r.prototype[Symbol.for("nodejs.util.inspect.custom")]=u}catch(t){r.prototype.inspect=u}else r.prototype.inspect=u;function u(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}var p=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],d=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],c=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function m(t,e,n){n.negative=e.negative^t.negative;var i=t.length+e.length|0;n.length=i,i=i-1|0;var r=0|t.words[0],s=0|e.words[0],o=r*s,a=67108863&o,l=o/67108864|0;n.words[0]=a;for(var h=1;h<i;h++){for(var u=l>>>26,p=67108863&l,d=Math.min(h,e.length-1),c=Math.max(0,h-t.length+1);c<=d;c++){var m=h-c|0;u+=(o=(r=0|t.words[m])*(s=0|e.words[c])+p)/67108864|0,p=67108863&o}n.words[h]=0|p,l=0|u}return 0!==l?n.words[h]=0|l:n.length--,n._strip()}r.prototype.toString=function(t,e){var i;if(e=0|e||1,16===(t=t||10)||"hex"===t){i="";for(var r=0,s=0,o=0;o<this.length;o++){var a=this.words[o],l=(16777215&(a<<r|s)).toString(16);s=a>>>24-r&16777215,(r+=2)>=26&&(r-=26,o--),i=0!==s||o!==this.length-1?p[6-l.length]+l+i:l+i}for(0!==s&&(i=s.toString(16)+i);i.length%e!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}if(t===(0|t)&&t>=2&&t<=36){var h=d[t],u=c[t];i="";var m=this.clone();for(m.negative=0;!m.isZero();){var f=m.modrn(u).toString(t);i=(m=m.idivn(u)).isZero()?f+i:p[h-f.length]+f+i}for(this.isZero()&&(i="0"+i);i.length%e!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}n(!1,"Base should be between 2 and 36")},r.prototype.toNumber=function(){var t=this.words[0];return 2===this.length?t+=67108864*this.words[1]:3===this.length&&1===this.words[2]?t+=4503599627370496+67108864*this.words[1]:this.length>2&&n(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-t:t},r.prototype.toJSON=function(){return this.toString(16,2)},s&&(r.prototype.toBuffer=function(t,e){return this.toArrayLike(s,t,e)}),r.prototype.toArray=function(t,e){return this.toArrayLike(Array,t,e)},r.prototype.toArrayLike=function(t,e,i){this._strip();var r=this.byteLength(),s=i||Math.max(1,r);n(r<=s,"byte array longer than desired length"),n(s>0,"Requested array length <= 0");var o=function(t,e){return t.allocUnsafe?t.allocUnsafe(e):new t(e)}(t,s);return this["_toArrayLike"+("le"===e?"LE":"BE")](o,r),o},r.prototype._toArrayLikeLE=function(t,e){for(var n=0,i=0,r=0,s=0;r<this.length;r++){var o=this.words[r]<<s|i;t[n++]=255&o,n<t.length&&(t[n++]=o>>8&255),n<t.length&&(t[n++]=o>>16&255),6===s?(n<t.length&&(t[n++]=o>>24&255),i=0,s=0):(i=o>>>24,s+=2)}if(n<t.length)for(t[n++]=i;n<t.length;)t[n++]=0},r.prototype._toArrayLikeBE=function(t,e){for(var n=t.length-1,i=0,r=0,s=0;r<this.length;r++){var o=this.words[r]<<s|i;t[n--]=255&o,n>=0&&(t[n--]=o>>8&255),n>=0&&(t[n--]=o>>16&255),6===s?(n>=0&&(t[n--]=o>>24&255),i=0,s=0):(i=o>>>24,s+=2)}if(n>=0)for(t[n--]=i;n>=0;)t[n--]=0},Math.clz32?r.prototype._countBits=function(t){return 32-Math.clz32(t)}:r.prototype._countBits=function(t){var e=t,n=0;return e>=4096&&(n+=13,e>>>=13),e>=64&&(n+=7,e>>>=7),e>=8&&(n+=4,e>>>=4),e>=2&&(n+=2,e>>>=2),n+e},r.prototype._zeroBits=function(t){if(0===t)return 26;var e=t,n=0;return 0==(8191&e)&&(n+=13,e>>>=13),0==(127&e)&&(n+=7,e>>>=7),0==(15&e)&&(n+=4,e>>>=4),0==(3&e)&&(n+=2,e>>>=2),0==(1&e)&&n++,n},r.prototype.bitLength=function(){var t=this.words[this.length-1],e=this._countBits(t);return 26*(this.length-1)+e},r.prototype.zeroBits=function(){if(this.isZero())return 0;for(var t=0,e=0;e<this.length;e++){var n=this._zeroBits(this.words[e]);if(t+=n,26!==n)break}return t},r.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},r.prototype.toTwos=function(t){return 0!==this.negative?this.abs().inotn(t).iaddn(1):this.clone()},r.prototype.fromTwos=function(t){return this.testn(t-1)?this.notn(t).iaddn(1).ineg():this.clone()},r.prototype.isNeg=function(){return 0!==this.negative},r.prototype.neg=function(){return this.clone().ineg()},r.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},r.prototype.iuor=function(t){for(;this.length<t.length;)this.words[this.length++]=0;for(var e=0;e<t.length;e++)this.words[e]=this.words[e]|t.words[e];return this._strip()},r.prototype.ior=function(t){return n(0==(this.negative|t.negative)),this.iuor(t)},r.prototype.or=function(t){return this.length>t.length?this.clone().ior(t):t.clone().ior(this)},r.prototype.uor=function(t){return this.length>t.length?this.clone().iuor(t):t.clone().iuor(this)},r.prototype.iuand=function(t){var e;e=this.length>t.length?t:this;for(var n=0;n<e.length;n++)this.words[n]=this.words[n]&t.words[n];return this.length=e.length,this._strip()},r.prototype.iand=function(t){return n(0==(this.negative|t.negative)),this.iuand(t)},r.prototype.and=function(t){return this.length>t.length?this.clone().iand(t):t.clone().iand(this)},r.prototype.uand=function(t){return this.length>t.length?this.clone().iuand(t):t.clone().iuand(this)},r.prototype.iuxor=function(t){var e,n;this.length>t.length?(e=this,n=t):(e=t,n=this);for(var i=0;i<n.length;i++)this.words[i]=e.words[i]^n.words[i];if(this!==e)for(;i<e.length;i++)this.words[i]=e.words[i];return this.length=e.length,this._strip()},r.prototype.ixor=function(t){return n(0==(this.negative|t.negative)),this.iuxor(t)},r.prototype.xor=function(t){return this.length>t.length?this.clone().ixor(t):t.clone().ixor(this)},r.prototype.uxor=function(t){return this.length>t.length?this.clone().iuxor(t):t.clone().iuxor(this)},r.prototype.inotn=function(t){n("number"==typeof t&&t>=0);var e=0|Math.ceil(t/26),i=t%26;this._expand(e),i>0&&e--;for(var r=0;r<e;r++)this.words[r]=67108863&~this.words[r];return i>0&&(this.words[r]=~this.words[r]&67108863>>26-i),this._strip()},r.prototype.notn=function(t){return this.clone().inotn(t)},r.prototype.setn=function(t,e){n("number"==typeof t&&t>=0);var i=t/26|0,r=t%26;return this._expand(i+1),this.words[i]=e?this.words[i]|1<<r:this.words[i]&~(1<<r),this._strip()},r.prototype.iadd=function(t){var e,n,i;if(0!==this.negative&&0===t.negative)return this.negative=0,e=this.isub(t),this.negative^=1,this._normSign();if(0===this.negative&&0!==t.negative)return t.negative=0,e=this.isub(t),t.negative=1,e._normSign();this.length>t.length?(n=this,i=t):(n=t,i=this);for(var r=0,s=0;s<i.length;s++)e=(0|n.words[s])+(0|i.words[s])+r,this.words[s]=67108863&e,r=e>>>26;for(;0!==r&&s<n.length;s++)e=(0|n.words[s])+r,this.words[s]=67108863&e,r=e>>>26;if(this.length=n.length,0!==r)this.words[this.length]=r,this.length++;else if(n!==this)for(;s<n.length;s++)this.words[s]=n.words[s];return this},r.prototype.add=function(t){var e;return 0!==t.negative&&0===this.negative?(t.negative=0,e=this.sub(t),t.negative^=1,e):0===t.negative&&0!==this.negative?(this.negative=0,e=t.sub(this),this.negative=1,e):this.length>t.length?this.clone().iadd(t):t.clone().iadd(this)},r.prototype.isub=function(t){if(0!==t.negative){t.negative=0;var e=this.iadd(t);return t.negative=1,e._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(t),this.negative=1,this._normSign();var n,i,r=this.cmp(t);if(0===r)return this.negative=0,this.length=1,this.words[0]=0,this;r>0?(n=this,i=t):(n=t,i=this);for(var s=0,o=0;o<i.length;o++)s=(e=(0|n.words[o])-(0|i.words[o])+s)>>26,this.words[o]=67108863&e;for(;0!==s&&o<n.length;o++)s=(e=(0|n.words[o])+s)>>26,this.words[o]=67108863&e;if(0===s&&o<n.length&&n!==this)for(;o<n.length;o++)this.words[o]=n.words[o];return this.length=Math.max(this.length,o),n!==this&&(this.negative=1),this._strip()},r.prototype.sub=function(t){return this.clone().isub(t)};var f=function(t,e,n){var i,r,s,o=t.words,a=e.words,l=n.words,h=0,u=0|o[0],p=8191&u,d=u>>>13,c=0|o[1],m=8191&c,f=c>>>13,g=0|o[2],y=8191&g,w=g>>>13,v=0|o[3],T=8191&v,b=v>>>13,E=0|o[4],M=8191&E,k=E>>>13,I=0|o[5],P=8191&I,x=I>>>13,_=0|o[6],A=8191&_,N=_>>>13,F=0|o[7],O=8191&F,S=F>>>13,R=0|o[8],B=8191&R,U=R>>>13,D=0|o[9],L=8191&D,C=D>>>13,G=0|a[0],q=8191&G,W=G>>>13,z=0|a[1],V=8191&z,j=z>>>13,$=0|a[2],H=8191&$,K=$>>>13,X=0|a[3],Z=8191&X,Y=X>>>13,Q=0|a[4],J=8191&Q,tt=Q>>>13,et=0|a[5],nt=8191&et,it=et>>>13,rt=0|a[6],st=8191&rt,ot=rt>>>13,at=0|a[7],lt=8191&at,ht=at>>>13,ut=0|a[8],pt=8191&ut,dt=ut>>>13,ct=0|a[9],mt=8191&ct,ft=ct>>>13;n.negative=t.negative^e.negative,n.length=19;var gt=(h+(i=Math.imul(p,q))|0)+((8191&(r=(r=Math.imul(p,W))+Math.imul(d,q)|0))<<13)|0;h=((s=Math.imul(d,W))+(r>>>13)|0)+(gt>>>26)|0,gt&=67108863,i=Math.imul(m,q),r=(r=Math.imul(m,W))+Math.imul(f,q)|0,s=Math.imul(f,W);var yt=(h+(i=i+Math.imul(p,V)|0)|0)+((8191&(r=(r=r+Math.imul(p,j)|0)+Math.imul(d,V)|0))<<13)|0;h=((s=s+Math.imul(d,j)|0)+(r>>>13)|0)+(yt>>>26)|0,yt&=67108863,i=Math.imul(y,q),r=(r=Math.imul(y,W))+Math.imul(w,q)|0,s=Math.imul(w,W),i=i+Math.imul(m,V)|0,r=(r=r+Math.imul(m,j)|0)+Math.imul(f,V)|0,s=s+Math.imul(f,j)|0;var wt=(h+(i=i+Math.imul(p,H)|0)|0)+((8191&(r=(r=r+Math.imul(p,K)|0)+Math.imul(d,H)|0))<<13)|0;h=((s=s+Math.imul(d,K)|0)+(r>>>13)|0)+(wt>>>26)|0,wt&=67108863,i=Math.imul(T,q),r=(r=Math.imul(T,W))+Math.imul(b,q)|0,s=Math.imul(b,W),i=i+Math.imul(y,V)|0,r=(r=r+Math.imul(y,j)|0)+Math.imul(w,V)|0,s=s+Math.imul(w,j)|0,i=i+Math.imul(m,H)|0,r=(r=r+Math.imul(m,K)|0)+Math.imul(f,H)|0,s=s+Math.imul(f,K)|0;var vt=(h+(i=i+Math.imul(p,Z)|0)|0)+((8191&(r=(r=r+Math.imul(p,Y)|0)+Math.imul(d,Z)|0))<<13)|0;h=((s=s+Math.imul(d,Y)|0)+(r>>>13)|0)+(vt>>>26)|0,vt&=67108863,i=Math.imul(M,q),r=(r=Math.imul(M,W))+Math.imul(k,q)|0,s=Math.imul(k,W),i=i+Math.imul(T,V)|0,r=(r=r+Math.imul(T,j)|0)+Math.imul(b,V)|0,s=s+Math.imul(b,j)|0,i=i+Math.imul(y,H)|0,r=(r=r+Math.imul(y,K)|0)+Math.imul(w,H)|0,s=s+Math.imul(w,K)|0,i=i+Math.imul(m,Z)|0,r=(r=r+Math.imul(m,Y)|0)+Math.imul(f,Z)|0,s=s+Math.imul(f,Y)|0;var Tt=(h+(i=i+Math.imul(p,J)|0)|0)+((8191&(r=(r=r+Math.imul(p,tt)|0)+Math.imul(d,J)|0))<<13)|0;h=((s=s+Math.imul(d,tt)|0)+(r>>>13)|0)+(Tt>>>26)|0,Tt&=67108863,i=Math.imul(P,q),r=(r=Math.imul(P,W))+Math.imul(x,q)|0,s=Math.imul(x,W),i=i+Math.imul(M,V)|0,r=(r=r+Math.imul(M,j)|0)+Math.imul(k,V)|0,s=s+Math.imul(k,j)|0,i=i+Math.imul(T,H)|0,r=(r=r+Math.imul(T,K)|0)+Math.imul(b,H)|0,s=s+Math.imul(b,K)|0,i=i+Math.imul(y,Z)|0,r=(r=r+Math.imul(y,Y)|0)+Math.imul(w,Z)|0,s=s+Math.imul(w,Y)|0,i=i+Math.imul(m,J)|0,r=(r=r+Math.imul(m,tt)|0)+Math.imul(f,J)|0,s=s+Math.imul(f,tt)|0;var bt=(h+(i=i+Math.imul(p,nt)|0)|0)+((8191&(r=(r=r+Math.imul(p,it)|0)+Math.imul(d,nt)|0))<<13)|0;h=((s=s+Math.imul(d,it)|0)+(r>>>13)|0)+(bt>>>26)|0,bt&=67108863,i=Math.imul(A,q),r=(r=Math.imul(A,W))+Math.imul(N,q)|0,s=Math.imul(N,W),i=i+Math.imul(P,V)|0,r=(r=r+Math.imul(P,j)|0)+Math.imul(x,V)|0,s=s+Math.imul(x,j)|0,i=i+Math.imul(M,H)|0,r=(r=r+Math.imul(M,K)|0)+Math.imul(k,H)|0,s=s+Math.imul(k,K)|0,i=i+Math.imul(T,Z)|0,r=(r=r+Math.imul(T,Y)|0)+Math.imul(b,Z)|0,s=s+Math.imul(b,Y)|0,i=i+Math.imul(y,J)|0,r=(r=r+Math.imul(y,tt)|0)+Math.imul(w,J)|0,s=s+Math.imul(w,tt)|0,i=i+Math.imul(m,nt)|0,r=(r=r+Math.imul(m,it)|0)+Math.imul(f,nt)|0,s=s+Math.imul(f,it)|0;var Et=(h+(i=i+Math.imul(p,st)|0)|0)+((8191&(r=(r=r+Math.imul(p,ot)|0)+Math.imul(d,st)|0))<<13)|0;h=((s=s+Math.imul(d,ot)|0)+(r>>>13)|0)+(Et>>>26)|0,Et&=67108863,i=Math.imul(O,q),r=(r=Math.imul(O,W))+Math.imul(S,q)|0,s=Math.imul(S,W),i=i+Math.imul(A,V)|0,r=(r=r+Math.imul(A,j)|0)+Math.imul(N,V)|0,s=s+Math.imul(N,j)|0,i=i+Math.imul(P,H)|0,r=(r=r+Math.imul(P,K)|0)+Math.imul(x,H)|0,s=s+Math.imul(x,K)|0,i=i+Math.imul(M,Z)|0,r=(r=r+Math.imul(M,Y)|0)+Math.imul(k,Z)|0,s=s+Math.imul(k,Y)|0,i=i+Math.imul(T,J)|0,r=(r=r+Math.imul(T,tt)|0)+Math.imul(b,J)|0,s=s+Math.imul(b,tt)|0,i=i+Math.imul(y,nt)|0,r=(r=r+Math.imul(y,it)|0)+Math.imul(w,nt)|0,s=s+Math.imul(w,it)|0,i=i+Math.imul(m,st)|0,r=(r=r+Math.imul(m,ot)|0)+Math.imul(f,st)|0,s=s+Math.imul(f,ot)|0;var Mt=(h+(i=i+Math.imul(p,lt)|0)|0)+((8191&(r=(r=r+Math.imul(p,ht)|0)+Math.imul(d,lt)|0))<<13)|0;h=((s=s+Math.imul(d,ht)|0)+(r>>>13)|0)+(Mt>>>26)|0,Mt&=67108863,i=Math.imul(B,q),r=(r=Math.imul(B,W))+Math.imul(U,q)|0,s=Math.imul(U,W),i=i+Math.imul(O,V)|0,r=(r=r+Math.imul(O,j)|0)+Math.imul(S,V)|0,s=s+Math.imul(S,j)|0,i=i+Math.imul(A,H)|0,r=(r=r+Math.imul(A,K)|0)+Math.imul(N,H)|0,s=s+Math.imul(N,K)|0,i=i+Math.imul(P,Z)|0,r=(r=r+Math.imul(P,Y)|0)+Math.imul(x,Z)|0,s=s+Math.imul(x,Y)|0,i=i+Math.imul(M,J)|0,r=(r=r+Math.imul(M,tt)|0)+Math.imul(k,J)|0,s=s+Math.imul(k,tt)|0,i=i+Math.imul(T,nt)|0,r=(r=r+Math.imul(T,it)|0)+Math.imul(b,nt)|0,s=s+Math.imul(b,it)|0,i=i+Math.imul(y,st)|0,r=(r=r+Math.imul(y,ot)|0)+Math.imul(w,st)|0,s=s+Math.imul(w,ot)|0,i=i+Math.imul(m,lt)|0,r=(r=r+Math.imul(m,ht)|0)+Math.imul(f,lt)|0,s=s+Math.imul(f,ht)|0;var kt=(h+(i=i+Math.imul(p,pt)|0)|0)+((8191&(r=(r=r+Math.imul(p,dt)|0)+Math.imul(d,pt)|0))<<13)|0;h=((s=s+Math.imul(d,dt)|0)+(r>>>13)|0)+(kt>>>26)|0,kt&=67108863,i=Math.imul(L,q),r=(r=Math.imul(L,W))+Math.imul(C,q)|0,s=Math.imul(C,W),i=i+Math.imul(B,V)|0,r=(r=r+Math.imul(B,j)|0)+Math.imul(U,V)|0,s=s+Math.imul(U,j)|0,i=i+Math.imul(O,H)|0,r=(r=r+Math.imul(O,K)|0)+Math.imul(S,H)|0,s=s+Math.imul(S,K)|0,i=i+Math.imul(A,Z)|0,r=(r=r+Math.imul(A,Y)|0)+Math.imul(N,Z)|0,s=s+Math.imul(N,Y)|0,i=i+Math.imul(P,J)|0,r=(r=r+Math.imul(P,tt)|0)+Math.imul(x,J)|0,s=s+Math.imul(x,tt)|0,i=i+Math.imul(M,nt)|0,r=(r=r+Math.imul(M,it)|0)+Math.imul(k,nt)|0,s=s+Math.imul(k,it)|0,i=i+Math.imul(T,st)|0,r=(r=r+Math.imul(T,ot)|0)+Math.imul(b,st)|0,s=s+Math.imul(b,ot)|0,i=i+Math.imul(y,lt)|0,r=(r=r+Math.imul(y,ht)|0)+Math.imul(w,lt)|0,s=s+Math.imul(w,ht)|0,i=i+Math.imul(m,pt)|0,r=(r=r+Math.imul(m,dt)|0)+Math.imul(f,pt)|0,s=s+Math.imul(f,dt)|0;var It=(h+(i=i+Math.imul(p,mt)|0)|0)+((8191&(r=(r=r+Math.imul(p,ft)|0)+Math.imul(d,mt)|0))<<13)|0;h=((s=s+Math.imul(d,ft)|0)+(r>>>13)|0)+(It>>>26)|0,It&=67108863,i=Math.imul(L,V),r=(r=Math.imul(L,j))+Math.imul(C,V)|0,s=Math.imul(C,j),i=i+Math.imul(B,H)|0,r=(r=r+Math.imul(B,K)|0)+Math.imul(U,H)|0,s=s+Math.imul(U,K)|0,i=i+Math.imul(O,Z)|0,r=(r=r+Math.imul(O,Y)|0)+Math.imul(S,Z)|0,s=s+Math.imul(S,Y)|0,i=i+Math.imul(A,J)|0,r=(r=r+Math.imul(A,tt)|0)+Math.imul(N,J)|0,s=s+Math.imul(N,tt)|0,i=i+Math.imul(P,nt)|0,r=(r=r+Math.imul(P,it)|0)+Math.imul(x,nt)|0,s=s+Math.imul(x,it)|0,i=i+Math.imul(M,st)|0,r=(r=r+Math.imul(M,ot)|0)+Math.imul(k,st)|0,s=s+Math.imul(k,ot)|0,i=i+Math.imul(T,lt)|0,r=(r=r+Math.imul(T,ht)|0)+Math.imul(b,lt)|0,s=s+Math.imul(b,ht)|0,i=i+Math.imul(y,pt)|0,r=(r=r+Math.imul(y,dt)|0)+Math.imul(w,pt)|0,s=s+Math.imul(w,dt)|0;var Pt=(h+(i=i+Math.imul(m,mt)|0)|0)+((8191&(r=(r=r+Math.imul(m,ft)|0)+Math.imul(f,mt)|0))<<13)|0;h=((s=s+Math.imul(f,ft)|0)+(r>>>13)|0)+(Pt>>>26)|0,Pt&=67108863,i=Math.imul(L,H),r=(r=Math.imul(L,K))+Math.imul(C,H)|0,s=Math.imul(C,K),i=i+Math.imul(B,Z)|0,r=(r=r+Math.imul(B,Y)|0)+Math.imul(U,Z)|0,s=s+Math.imul(U,Y)|0,i=i+Math.imul(O,J)|0,r=(r=r+Math.imul(O,tt)|0)+Math.imul(S,J)|0,s=s+Math.imul(S,tt)|0,i=i+Math.imul(A,nt)|0,r=(r=r+Math.imul(A,it)|0)+Math.imul(N,nt)|0,s=s+Math.imul(N,it)|0,i=i+Math.imul(P,st)|0,r=(r=r+Math.imul(P,ot)|0)+Math.imul(x,st)|0,s=s+Math.imul(x,ot)|0,i=i+Math.imul(M,lt)|0,r=(r=r+Math.imul(M,ht)|0)+Math.imul(k,lt)|0,s=s+Math.imul(k,ht)|0,i=i+Math.imul(T,pt)|0,r=(r=r+Math.imul(T,dt)|0)+Math.imul(b,pt)|0,s=s+Math.imul(b,dt)|0;var xt=(h+(i=i+Math.imul(y,mt)|0)|0)+((8191&(r=(r=r+Math.imul(y,ft)|0)+Math.imul(w,mt)|0))<<13)|0;h=((s=s+Math.imul(w,ft)|0)+(r>>>13)|0)+(xt>>>26)|0,xt&=67108863,i=Math.imul(L,Z),r=(r=Math.imul(L,Y))+Math.imul(C,Z)|0,s=Math.imul(C,Y),i=i+Math.imul(B,J)|0,r=(r=r+Math.imul(B,tt)|0)+Math.imul(U,J)|0,s=s+Math.imul(U,tt)|0,i=i+Math.imul(O,nt)|0,r=(r=r+Math.imul(O,it)|0)+Math.imul(S,nt)|0,s=s+Math.imul(S,it)|0,i=i+Math.imul(A,st)|0,r=(r=r+Math.imul(A,ot)|0)+Math.imul(N,st)|0,s=s+Math.imul(N,ot)|0,i=i+Math.imul(P,lt)|0,r=(r=r+Math.imul(P,ht)|0)+Math.imul(x,lt)|0,s=s+Math.imul(x,ht)|0,i=i+Math.imul(M,pt)|0,r=(r=r+Math.imul(M,dt)|0)+Math.imul(k,pt)|0,s=s+Math.imul(k,dt)|0;var _t=(h+(i=i+Math.imul(T,mt)|0)|0)+((8191&(r=(r=r+Math.imul(T,ft)|0)+Math.imul(b,mt)|0))<<13)|0;h=((s=s+Math.imul(b,ft)|0)+(r>>>13)|0)+(_t>>>26)|0,_t&=67108863,i=Math.imul(L,J),r=(r=Math.imul(L,tt))+Math.imul(C,J)|0,s=Math.imul(C,tt),i=i+Math.imul(B,nt)|0,r=(r=r+Math.imul(B,it)|0)+Math.imul(U,nt)|0,s=s+Math.imul(U,it)|0,i=i+Math.imul(O,st)|0,r=(r=r+Math.imul(O,ot)|0)+Math.imul(S,st)|0,s=s+Math.imul(S,ot)|0,i=i+Math.imul(A,lt)|0,r=(r=r+Math.imul(A,ht)|0)+Math.imul(N,lt)|0,s=s+Math.imul(N,ht)|0,i=i+Math.imul(P,pt)|0,r=(r=r+Math.imul(P,dt)|0)+Math.imul(x,pt)|0,s=s+Math.imul(x,dt)|0;var At=(h+(i=i+Math.imul(M,mt)|0)|0)+((8191&(r=(r=r+Math.imul(M,ft)|0)+Math.imul(k,mt)|0))<<13)|0;h=((s=s+Math.imul(k,ft)|0)+(r>>>13)|0)+(At>>>26)|0,At&=67108863,i=Math.imul(L,nt),r=(r=Math.imul(L,it))+Math.imul(C,nt)|0,s=Math.imul(C,it),i=i+Math.imul(B,st)|0,r=(r=r+Math.imul(B,ot)|0)+Math.imul(U,st)|0,s=s+Math.imul(U,ot)|0,i=i+Math.imul(O,lt)|0,r=(r=r+Math.imul(O,ht)|0)+Math.imul(S,lt)|0,s=s+Math.imul(S,ht)|0,i=i+Math.imul(A,pt)|0,r=(r=r+Math.imul(A,dt)|0)+Math.imul(N,pt)|0,s=s+Math.imul(N,dt)|0;var Nt=(h+(i=i+Math.imul(P,mt)|0)|0)+((8191&(r=(r=r+Math.imul(P,ft)|0)+Math.imul(x,mt)|0))<<13)|0;h=((s=s+Math.imul(x,ft)|0)+(r>>>13)|0)+(Nt>>>26)|0,Nt&=67108863,i=Math.imul(L,st),r=(r=Math.imul(L,ot))+Math.imul(C,st)|0,s=Math.imul(C,ot),i=i+Math.imul(B,lt)|0,r=(r=r+Math.imul(B,ht)|0)+Math.imul(U,lt)|0,s=s+Math.imul(U,ht)|0,i=i+Math.imul(O,pt)|0,r=(r=r+Math.imul(O,dt)|0)+Math.imul(S,pt)|0,s=s+Math.imul(S,dt)|0;var Ft=(h+(i=i+Math.imul(A,mt)|0)|0)+((8191&(r=(r=r+Math.imul(A,ft)|0)+Math.imul(N,mt)|0))<<13)|0;h=((s=s+Math.imul(N,ft)|0)+(r>>>13)|0)+(Ft>>>26)|0,Ft&=67108863,i=Math.imul(L,lt),r=(r=Math.imul(L,ht))+Math.imul(C,lt)|0,s=Math.imul(C,ht),i=i+Math.imul(B,pt)|0,r=(r=r+Math.imul(B,dt)|0)+Math.imul(U,pt)|0,s=s+Math.imul(U,dt)|0;var Ot=(h+(i=i+Math.imul(O,mt)|0)|0)+((8191&(r=(r=r+Math.imul(O,ft)|0)+Math.imul(S,mt)|0))<<13)|0;h=((s=s+Math.imul(S,ft)|0)+(r>>>13)|0)+(Ot>>>26)|0,Ot&=67108863,i=Math.imul(L,pt),r=(r=Math.imul(L,dt))+Math.imul(C,pt)|0,s=Math.imul(C,dt);var St=(h+(i=i+Math.imul(B,mt)|0)|0)+((8191&(r=(r=r+Math.imul(B,ft)|0)+Math.imul(U,mt)|0))<<13)|0;h=((s=s+Math.imul(U,ft)|0)+(r>>>13)|0)+(St>>>26)|0,St&=67108863;var Rt=(h+(i=Math.imul(L,mt))|0)+((8191&(r=(r=Math.imul(L,ft))+Math.imul(C,mt)|0))<<13)|0;return h=((s=Math.imul(C,ft))+(r>>>13)|0)+(Rt>>>26)|0,Rt&=67108863,l[0]=gt,l[1]=yt,l[2]=wt,l[3]=vt,l[4]=Tt,l[5]=bt,l[6]=Et,l[7]=Mt,l[8]=kt,l[9]=It,l[10]=Pt,l[11]=xt,l[12]=_t,l[13]=At,l[14]=Nt,l[15]=Ft,l[16]=Ot,l[17]=St,l[18]=Rt,0!==h&&(l[19]=h,n.length++),n};function g(t,e,n){n.negative=e.negative^t.negative,n.length=t.length+e.length;for(var i=0,r=0,s=0;s<n.length-1;s++){var o=r;r=0;for(var a=67108863&i,l=Math.min(s,e.length-1),h=Math.max(0,s-t.length+1);h<=l;h++){var u=s-h,p=(0|t.words[u])*(0|e.words[h]),d=67108863&p;a=67108863&(d=d+a|0),r+=(o=(o=o+(p/67108864|0)|0)+(d>>>26)|0)>>>26,o&=67108863}n.words[s]=a,i=o,o=r}return 0!==i?n.words[s]=i:n.length--,n._strip()}function y(t,e,n){return g(t,e,n)}Math.imul||(f=m),r.prototype.mulTo=function(t,e){var n=this.length+t.length;return 10===this.length&&10===t.length?f(this,t,e):n<63?m(this,t,e):n<1024?g(this,t,e):y(this,t,e)},r.prototype.mul=function(t){var e=new r(null);return e.words=new Array(this.length+t.length),this.mulTo(t,e)},r.prototype.mulf=function(t){var e=new r(null);return e.words=new Array(this.length+t.length),y(this,t,e)},r.prototype.imul=function(t){return this.clone().mulTo(t,this)},r.prototype.imuln=function(t){var e=t<0;e&&(t=-t),n("number"==typeof t),n(t<67108864);for(var i=0,r=0;r<this.length;r++){var s=(0|this.words[r])*t,o=(67108863&s)+(67108863&i);i>>=26,i+=s/67108864|0,i+=o>>>26,this.words[r]=67108863&o}return 0!==i&&(this.words[r]=i,this.length++),e?this.ineg():this},r.prototype.muln=function(t){return this.clone().imuln(t)},r.prototype.sqr=function(){return this.mul(this)},r.prototype.isqr=function(){return this.imul(this.clone())},r.prototype.pow=function(t){var e=function(t){for(var e=new Array(t.bitLength()),n=0;n<e.length;n++){var i=n/26|0,r=n%26;e[n]=t.words[i]>>>r&1}return e}(t);if(0===e.length)return new r(1);for(var n=this,i=0;i<e.length&&0===e[i];i++,n=n.sqr());if(++i<e.length)for(var s=n.sqr();i<e.length;i++,s=s.sqr())0!==e[i]&&(n=n.mul(s));return n},r.prototype.iushln=function(t){n("number"==typeof t&&t>=0);var e,i=t%26,r=(t-i)/26,s=67108863>>>26-i<<26-i;if(0!==i){var o=0;for(e=0;e<this.length;e++){var a=this.words[e]&s,l=(0|this.words[e])-a<<i;this.words[e]=l|o,o=a>>>26-i}o&&(this.words[e]=o,this.length++)}if(0!==r){for(e=this.length-1;e>=0;e--)this.words[e+r]=this.words[e];for(e=0;e<r;e++)this.words[e]=0;this.length+=r}return this._strip()},r.prototype.ishln=function(t){return n(0===this.negative),this.iushln(t)},r.prototype.iushrn=function(t,e,i){var r;n("number"==typeof t&&t>=0),r=e?(e-e%26)/26:0;var s=t%26,o=Math.min((t-s)/26,this.length),a=67108863^67108863>>>s<<s,l=i;if(r-=o,r=Math.max(0,r),l){for(var h=0;h<o;h++)l.words[h]=this.words[h];l.length=o}if(0===o);else if(this.length>o)for(this.length-=o,h=0;h<this.length;h++)this.words[h]=this.words[h+o];else this.words[0]=0,this.length=1;var u=0;for(h=this.length-1;h>=0&&(0!==u||h>=r);h--){var p=0|this.words[h];this.words[h]=u<<26-s|p>>>s,u=p&a}return l&&0!==u&&(l.words[l.length++]=u),0===this.length&&(this.words[0]=0,this.length=1),this._strip()},r.prototype.ishrn=function(t,e,i){return n(0===this.negative),this.iushrn(t,e,i)},r.prototype.shln=function(t){return this.clone().ishln(t)},r.prototype.ushln=function(t){return this.clone().iushln(t)},r.prototype.shrn=function(t){return this.clone().ishrn(t)},r.prototype.ushrn=function(t){return this.clone().iushrn(t)},r.prototype.testn=function(t){n("number"==typeof t&&t>=0);var e=t%26,i=(t-e)/26,r=1<<e;return!(this.length<=i||!(this.words[i]&r))},r.prototype.imaskn=function(t){n("number"==typeof t&&t>=0);var e=t%26,i=(t-e)/26;if(n(0===this.negative,"imaskn works only with positive numbers"),this.length<=i)return this;if(0!==e&&i++,this.length=Math.min(i,this.length),0!==e){var r=67108863^67108863>>>e<<e;this.words[this.length-1]&=r}return this._strip()},r.prototype.maskn=function(t){return this.clone().imaskn(t)},r.prototype.iaddn=function(t){return n("number"==typeof t),n(t<67108864),t<0?this.isubn(-t):0!==this.negative?1===this.length&&(0|this.words[0])<=t?(this.words[0]=t-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(t),this.negative=1,this):this._iaddn(t)},r.prototype._iaddn=function(t){this.words[0]+=t;for(var e=0;e<this.length&&this.words[e]>=67108864;e++)this.words[e]-=67108864,e===this.length-1?this.words[e+1]=1:this.words[e+1]++;return this.length=Math.max(this.length,e+1),this},r.prototype.isubn=function(t){if(n("number"==typeof t),n(t<67108864),t<0)return this.iaddn(-t);if(0!==this.negative)return this.negative=0,this.iaddn(t),this.negative=1,this;if(this.words[0]-=t,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var e=0;e<this.length&&this.words[e]<0;e++)this.words[e]+=67108864,this.words[e+1]-=1;return this._strip()},r.prototype.addn=function(t){return this.clone().iaddn(t)},r.prototype.subn=function(t){return this.clone().isubn(t)},r.prototype.iabs=function(){return this.negative=0,this},r.prototype.abs=function(){return this.clone().iabs()},r.prototype._ishlnsubmul=function(t,e,i){var r,s,o=t.length+i;this._expand(o);var a=0;for(r=0;r<t.length;r++){s=(0|this.words[r+i])+a;var l=(0|t.words[r])*e;a=((s-=67108863&l)>>26)-(l/67108864|0),this.words[r+i]=67108863&s}for(;r<this.length-i;r++)a=(s=(0|this.words[r+i])+a)>>26,this.words[r+i]=67108863&s;if(0===a)return this._strip();for(n(-1===a),a=0,r=0;r<this.length;r++)a=(s=-(0|this.words[r])+a)>>26,this.words[r]=67108863&s;return this.negative=1,this._strip()},r.prototype._wordDiv=function(t,e){var n=(this.length,t.length),i=this.clone(),s=t,o=0|s.words[s.length-1];0!=(n=26-this._countBits(o))&&(s=s.ushln(n),i.iushln(n),o=0|s.words[s.length-1]);var a,l=i.length-s.length;if("mod"!==e){(a=new r(null)).length=l+1,a.words=new Array(a.length);for(var h=0;h<a.length;h++)a.words[h]=0}var u=i.clone()._ishlnsubmul(s,1,l);0===u.negative&&(i=u,a&&(a.words[l]=1));for(var p=l-1;p>=0;p--){var d=67108864*(0|i.words[s.length+p])+(0|i.words[s.length+p-1]);for(d=Math.min(d/o|0,67108863),i._ishlnsubmul(s,d,p);0!==i.negative;)d--,i.negative=0,i._ishlnsubmul(s,1,p),i.isZero()||(i.negative^=1);a&&(a.words[p]=d)}return a&&a._strip(),i._strip(),"div"!==e&&0!==n&&i.iushrn(n),{div:a||null,mod:i}},r.prototype.divmod=function(t,e,i){return n(!t.isZero()),this.isZero()?{div:new r(0),mod:new r(0)}:0!==this.negative&&0===t.negative?(a=this.neg().divmod(t,e),"mod"!==e&&(s=a.div.neg()),"div"!==e&&(o=a.mod.neg(),i&&0!==o.negative&&o.iadd(t)),{div:s,mod:o}):0===this.negative&&0!==t.negative?(a=this.divmod(t.neg(),e),"mod"!==e&&(s=a.div.neg()),{div:s,mod:a.mod}):0!=(this.negative&t.negative)?(a=this.neg().divmod(t.neg(),e),"div"!==e&&(o=a.mod.neg(),i&&0!==o.negative&&o.isub(t)),{div:a.div,mod:o}):t.length>this.length||this.cmp(t)<0?{div:new r(0),mod:this}:1===t.length?"div"===e?{div:this.divn(t.words[0]),mod:null}:"mod"===e?{div:null,mod:new r(this.modrn(t.words[0]))}:{div:this.divn(t.words[0]),mod:new r(this.modrn(t.words[0]))}:this._wordDiv(t,e);var s,o,a},r.prototype.div=function(t){return this.divmod(t,"div",!1).div},r.prototype.mod=function(t){return this.divmod(t,"mod",!1).mod},r.prototype.umod=function(t){return this.divmod(t,"mod",!0).mod},r.prototype.divRound=function(t){var e=this.divmod(t);if(e.mod.isZero())return e.div;var n=0!==e.div.negative?e.mod.isub(t):e.mod,i=t.ushrn(1),r=t.andln(1),s=n.cmp(i);return s<0||1===r&&0===s?e.div:0!==e.div.negative?e.div.isubn(1):e.div.iaddn(1)},r.prototype.modrn=function(t){var e=t<0;e&&(t=-t),n(t<=67108863);for(var i=(1<<26)%t,r=0,s=this.length-1;s>=0;s--)r=(i*r+(0|this.words[s]))%t;return e?-r:r},r.prototype.modn=function(t){return this.modrn(t)},r.prototype.idivn=function(t){var e=t<0;e&&(t=-t),n(t<=67108863);for(var i=0,r=this.length-1;r>=0;r--){var s=(0|this.words[r])+67108864*i;this.words[r]=s/t|0,i=s%t}return this._strip(),e?this.ineg():this},r.prototype.divn=function(t){return this.clone().idivn(t)},r.prototype.egcd=function(t){n(0===t.negative),n(!t.isZero());var e=this,i=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var s=new r(1),o=new r(0),a=new r(0),l=new r(1),h=0;e.isEven()&&i.isEven();)e.iushrn(1),i.iushrn(1),++h;for(var u=i.clone(),p=e.clone();!e.isZero();){for(var d=0,c=1;0==(e.words[0]&c)&&d<26;++d,c<<=1);if(d>0)for(e.iushrn(d);d-- >0;)(s.isOdd()||o.isOdd())&&(s.iadd(u),o.isub(p)),s.iushrn(1),o.iushrn(1);for(var m=0,f=1;0==(i.words[0]&f)&&m<26;++m,f<<=1);if(m>0)for(i.iushrn(m);m-- >0;)(a.isOdd()||l.isOdd())&&(a.iadd(u),l.isub(p)),a.iushrn(1),l.iushrn(1);e.cmp(i)>=0?(e.isub(i),s.isub(a),o.isub(l)):(i.isub(e),a.isub(s),l.isub(o))}return{a:a,b:l,gcd:i.iushln(h)}},r.prototype._invmp=function(t){n(0===t.negative),n(!t.isZero());var e=this,i=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var s,o=new r(1),a=new r(0),l=i.clone();e.cmpn(1)>0&&i.cmpn(1)>0;){for(var h=0,u=1;0==(e.words[0]&u)&&h<26;++h,u<<=1);if(h>0)for(e.iushrn(h);h-- >0;)o.isOdd()&&o.iadd(l),o.iushrn(1);for(var p=0,d=1;0==(i.words[0]&d)&&p<26;++p,d<<=1);if(p>0)for(i.iushrn(p);p-- >0;)a.isOdd()&&a.iadd(l),a.iushrn(1);e.cmp(i)>=0?(e.isub(i),o.isub(a)):(i.isub(e),a.isub(o))}return(s=0===e.cmpn(1)?o:a).cmpn(0)<0&&s.iadd(t),s},r.prototype.gcd=function(t){if(this.isZero())return t.abs();if(t.isZero())return this.abs();var e=this.clone(),n=t.clone();e.negative=0,n.negative=0;for(var i=0;e.isEven()&&n.isEven();i++)e.iushrn(1),n.iushrn(1);for(;;){for(;e.isEven();)e.iushrn(1);for(;n.isEven();)n.iushrn(1);var r=e.cmp(n);if(r<0){var s=e;e=n,n=s}else if(0===r||0===n.cmpn(1))break;e.isub(n)}return n.iushln(i)},r.prototype.invm=function(t){return this.egcd(t).a.umod(t)},r.prototype.isEven=function(){return 0==(1&this.words[0])},r.prototype.isOdd=function(){return 1==(1&this.words[0])},r.prototype.andln=function(t){return this.words[0]&t},r.prototype.bincn=function(t){n("number"==typeof t);var e=t%26,i=(t-e)/26,r=1<<e;if(this.length<=i)return this._expand(i+1),this.words[i]|=r,this;for(var s=r,o=i;0!==s&&o<this.length;o++){var a=0|this.words[o];s=(a+=s)>>>26,a&=67108863,this.words[o]=a}return 0!==s&&(this.words[o]=s,this.length++),this},r.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},r.prototype.cmpn=function(t){var e,i=t<0;if(0!==this.negative&&!i)return-1;if(0===this.negative&&i)return 1;if(this._strip(),this.length>1)e=1;else{i&&(t=-t),n(t<=67108863,"Number is too big");var r=0|this.words[0];e=r===t?0:r<t?-1:1}return 0!==this.negative?0|-e:e},r.prototype.cmp=function(t){if(0!==this.negative&&0===t.negative)return-1;if(0===this.negative&&0!==t.negative)return 1;var e=this.ucmp(t);return 0!==this.negative?0|-e:e},r.prototype.ucmp=function(t){if(this.length>t.length)return 1;if(this.length<t.length)return-1;for(var e=0,n=this.length-1;n>=0;n--){var i=0|this.words[n],r=0|t.words[n];if(i!==r){i<r?e=-1:i>r&&(e=1);break}}return e},r.prototype.gtn=function(t){return 1===this.cmpn(t)},r.prototype.gt=function(t){return 1===this.cmp(t)},r.prototype.gten=function(t){return this.cmpn(t)>=0},r.prototype.gte=function(t){return this.cmp(t)>=0},r.prototype.ltn=function(t){return-1===this.cmpn(t)},r.prototype.lt=function(t){return-1===this.cmp(t)},r.prototype.lten=function(t){return this.cmpn(t)<=0},r.prototype.lte=function(t){return this.cmp(t)<=0},r.prototype.eqn=function(t){return 0===this.cmpn(t)},r.prototype.eq=function(t){return 0===this.cmp(t)},r.red=function(t){return new k(t)},r.prototype.toRed=function(t){return n(!this.red,"Already a number in reduction context"),n(0===this.negative,"red works only with positives"),t.convertTo(this)._forceRed(t)},r.prototype.fromRed=function(){return n(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},r.prototype._forceRed=function(t){return this.red=t,this},r.prototype.forceRed=function(t){return n(!this.red,"Already a number in reduction context"),this._forceRed(t)},r.prototype.redAdd=function(t){return n(this.red,"redAdd works only with red numbers"),this.red.add(this,t)},r.prototype.redIAdd=function(t){return n(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,t)},r.prototype.redSub=function(t){return n(this.red,"redSub works only with red numbers"),this.red.sub(this,t)},r.prototype.redISub=function(t){return n(this.red,"redISub works only with red numbers"),this.red.isub(this,t)},r.prototype.redShl=function(t){return n(this.red,"redShl works only with red numbers"),this.red.shl(this,t)},r.prototype.redMul=function(t){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.mul(this,t)},r.prototype.redIMul=function(t){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.imul(this,t)},r.prototype.redSqr=function(){return n(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},r.prototype.redISqr=function(){return n(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},r.prototype.redSqrt=function(){return n(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},r.prototype.redInvm=function(){return n(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},r.prototype.redNeg=function(){return n(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},r.prototype.redPow=function(t){return n(this.red&&!t.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,t)};var w={k256:null,p224:null,p192:null,p25519:null};function v(t,e){this.name=t,this.p=new r(e,16),this.n=this.p.bitLength(),this.k=new r(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function T(){v.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function b(){v.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function E(){v.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function M(){v.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function k(t){if("string"==typeof t){var e=r._prime(t);this.m=e.p,this.prime=e}else n(t.gtn(1),"modulus must be greater than 1"),this.m=t,this.prime=null}function I(t){k.call(this,t),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new r(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}v.prototype._tmp=function(){var t=new r(null);return t.words=new Array(Math.ceil(this.n/13)),t},v.prototype.ireduce=function(t){var e,n=t;do{this.split(n,this.tmp),e=(n=(n=this.imulK(n)).iadd(this.tmp)).bitLength()}while(e>this.n);var i=e<this.n?-1:n.ucmp(this.p);return 0===i?(n.words[0]=0,n.length=1):i>0?n.isub(this.p):void 0!==n.strip?n.strip():n._strip(),n},v.prototype.split=function(t,e){t.iushrn(this.n,0,e)},v.prototype.imulK=function(t){return t.imul(this.k)},i(T,v),T.prototype.split=function(t,e){for(var n=4194303,i=Math.min(t.length,9),r=0;r<i;r++)e.words[r]=t.words[r];if(e.length=i,t.length<=9)return t.words[0]=0,void(t.length=1);var s=t.words[9];for(e.words[e.length++]=s&n,r=10;r<t.length;r++){var o=0|t.words[r];t.words[r-10]=(o&n)<<4|s>>>22,s=o}s>>>=22,t.words[r-10]=s,0===s&&t.length>10?t.length-=10:t.length-=9},T.prototype.imulK=function(t){t.words[t.length]=0,t.words[t.length+1]=0,t.length+=2;for(var e=0,n=0;n<t.length;n++){var i=0|t.words[n];e+=977*i,t.words[n]=67108863&e,e=64*i+(e/67108864|0)}return 0===t.words[t.length-1]&&(t.length--,0===t.words[t.length-1]&&t.length--),t},i(b,v),i(E,v),i(M,v),M.prototype.imulK=function(t){for(var e=0,n=0;n<t.length;n++){var i=19*(0|t.words[n])+e,r=67108863&i;i>>>=26,t.words[n]=r,e=i}return 0!==e&&(t.words[t.length++]=e),t},r._prime=function(t){if(w[t])return w[t];var e;if("k256"===t)e=new T;else if("p224"===t)e=new b;else if("p192"===t)e=new E;else{if("p25519"!==t)throw new Error("Unknown prime "+t);e=new M}return w[t]=e,e},k.prototype._verify1=function(t){n(0===t.negative,"red works only with positives"),n(t.red,"red works only with red numbers")},k.prototype._verify2=function(t,e){n(0==(t.negative|e.negative),"red works only with positives"),n(t.red&&t.red===e.red,"red works only with red numbers")},k.prototype.imod=function(t){return this.prime?this.prime.ireduce(t)._forceRed(this):(h(t,t.umod(this.m)._forceRed(this)),t)},k.prototype.neg=function(t){return t.isZero()?t.clone():this.m.sub(t)._forceRed(this)},k.prototype.add=function(t,e){this._verify2(t,e);var n=t.add(e);return n.cmp(this.m)>=0&&n.isub(this.m),n._forceRed(this)},k.prototype.iadd=function(t,e){this._verify2(t,e);var n=t.iadd(e);return n.cmp(this.m)>=0&&n.isub(this.m),n},k.prototype.sub=function(t,e){this._verify2(t,e);var n=t.sub(e);return n.cmpn(0)<0&&n.iadd(this.m),n._forceRed(this)},k.prototype.isub=function(t,e){this._verify2(t,e);var n=t.isub(e);return n.cmpn(0)<0&&n.iadd(this.m),n},k.prototype.shl=function(t,e){return this._verify1(t),this.imod(t.ushln(e))},k.prototype.imul=function(t,e){return this._verify2(t,e),this.imod(t.imul(e))},k.prototype.mul=function(t,e){return this._verify2(t,e),this.imod(t.mul(e))},k.prototype.isqr=function(t){return this.imul(t,t.clone())},k.prototype.sqr=function(t){return this.mul(t,t)},k.prototype.sqrt=function(t){if(t.isZero())return t.clone();var e=this.m.andln(3);if(n(e%2==1),3===e){var i=this.m.add(new r(1)).iushrn(2);return this.pow(t,i)}for(var s=this.m.subn(1),o=0;!s.isZero()&&0===s.andln(1);)o++,s.iushrn(1);n(!s.isZero());var a=new r(1).toRed(this),l=a.redNeg(),h=this.m.subn(1).iushrn(1),u=this.m.bitLength();for(u=new r(2*u*u).toRed(this);0!==this.pow(u,h).cmp(l);)u.redIAdd(l);for(var p=this.pow(u,s),d=this.pow(t,s.addn(1).iushrn(1)),c=this.pow(t,s),m=o;0!==c.cmp(a);){for(var f=c,g=0;0!==f.cmp(a);g++)f=f.redSqr();n(g<m);var y=this.pow(p,new r(1).iushln(m-g-1));d=d.redMul(y),p=y.redSqr(),c=c.redMul(p),m=g}return d},k.prototype.invm=function(t){var e=t._invmp(this.m);return 0!==e.negative?(e.negative=0,this.imod(e).redNeg()):this.imod(e)},k.prototype.pow=function(t,e){if(e.isZero())return new r(1).toRed(this);if(0===e.cmpn(1))return t.clone();var n=new Array(16);n[0]=new r(1).toRed(this),n[1]=t;for(var i=2;i<n.length;i++)n[i]=this.mul(n[i-1],t);var s=n[0],o=0,a=0,l=e.bitLength()%26;for(0===l&&(l=26),i=e.length-1;i>=0;i--){for(var h=e.words[i],u=l-1;u>=0;u--){var p=h>>u&1;s!==n[0]&&(s=this.sqr(s)),0!==p||0!==o?(o<<=1,o|=p,(4==++a||0===i&&0===u)&&(s=this.mul(s,n[o]),a=0,o=0)):a=0}l=26}return s},k.prototype.convertTo=function(t){var e=t.umod(this.m);return e===t?e.clone():e},k.prototype.convertFrom=function(t){var e=t.clone();return e.red=null,e},r.mont=function(t){return new I(t)},i(I,k),I.prototype.convertTo=function(t){return this.imod(t.ushln(this.shift))},I.prototype.convertFrom=function(t){var e=this.imod(t.mul(this.rinv));return e.red=null,e},I.prototype.imul=function(t,e){if(t.isZero()||e.isZero())return t.words[0]=0,t.length=1,t;var n=t.imul(e),i=n.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),r=n.isub(i).iushrn(this.shift),s=r;return r.cmp(this.m)>=0?s=r.isub(this.m):r.cmpn(0)<0&&(s=r.iadd(this.m)),s._forceRed(this)},I.prototype.mul=function(t,e){if(t.isZero()||e.isZero())return new r(0)._forceRed(this);var n=t.mul(e),i=n.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),s=n.isub(i).iushrn(this.shift),o=s;return s.cmp(this.m)>=0?o=s.isub(this.m):s.cmpn(0)<0&&(o=s.iadd(this.m)),o._forceRed(this)},I.prototype.invm=function(t){return this.imod(t._invmp(this.m).mul(this.r2))._forceRed(this)}}(z,"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{});const V="bignumber/5.7.0";var j=z.exports.BN;const $=new O(V),H={},K=9007199254740991;let X=!1;class Z{constructor(t,e){t!==H&&$.throwError("cannot call constructor directly; use BigNumber.from",O.errors.UNSUPPORTED_OPERATION,{operation:"new (BigNumber)"}),this._hex=e,this._isBigNumber=!0,Object.freeze(this)}fromTwos(t){return Q(J(this).fromTwos(t))}toTwos(t){return Q(J(this).toTwos(t))}abs(){return"-"===this._hex[0]?Z.from(this._hex.substring(1)):this}add(t){return Q(J(this).add(J(t)))}sub(t){return Q(J(this).sub(J(t)))}div(t){return Z.from(t).isZero()&&tt("division-by-zero","div"),Q(J(this).div(J(t)))}mul(t){return Q(J(this).mul(J(t)))}mod(t){const e=J(t);return e.isNeg()&&tt("division-by-zero","mod"),Q(J(this).umod(e))}pow(t){const e=J(t);return e.isNeg()&&tt("negative-power","pow"),Q(J(this).pow(e))}and(t){const e=J(t);return(this.isNegative()||e.isNeg())&&tt("unbound-bitwise-result","and"),Q(J(this).and(e))}or(t){const e=J(t);return(this.isNegative()||e.isNeg())&&tt("unbound-bitwise-result","or"),Q(J(this).or(e))}xor(t){const e=J(t);return(this.isNegative()||e.isNeg())&&tt("unbound-bitwise-result","xor"),Q(J(this).xor(e))}mask(t){return(this.isNegative()||t<0)&&tt("negative-width","mask"),Q(J(this).maskn(t))}shl(t){return(this.isNegative()||t<0)&&tt("negative-width","shl"),Q(J(this).shln(t))}shr(t){return(this.isNegative()||t<0)&&tt("negative-width","shr"),Q(J(this).shrn(t))}eq(t){return J(this).eq(J(t))}lt(t){return J(this).lt(J(t))}lte(t){return J(this).lte(J(t))}gt(t){return J(this).gt(J(t))}gte(t){return J(this).gte(J(t))}isNegative(){return"-"===this._hex[0]}isZero(){return J(this).isZero()}toNumber(){try{return J(this).toNumber()}catch(t){tt("overflow","toNumber",this.toString())}return null}toBigInt(){try{return BigInt(this.toString())}catch(t){}return $.throwError("this platform does not support BigInt",O.errors.UNSUPPORTED_OPERATION,{value:this.toString()})}toString(){return arguments.length>0&&(10===arguments[0]?X||(X=!0,$.warn("BigNumber.toString does not accept any parameters; base-10 is assumed")):16===arguments[0]?$.throwError("BigNumber.toString does not accept any parameters; use bigNumber.toHexString()",O.errors.UNEXPECTED_ARGUMENT,{}):$.throwError("BigNumber.toString does not accept parameters",O.errors.UNEXPECTED_ARGUMENT,{})),J(this).toString(10)}toHexString(){return this._hex}toJSON(t){return{type:"BigNumber",hex:this.toHexString()}}static from(t){if(t instanceof Z)return t;if("string"==typeof t)return t.match(/^-?0x[0-9a-f]+$/i)?new Z(H,Y(t)):t.match(/^-?[0-9]+$/)?new Z(H,Y(new j(t))):$.throwArgumentError("invalid BigNumber string","value",t);if("number"==typeof t)return t%1&&tt("underflow","BigNumber.from",t),(t>=K||t<=-K)&&tt("overflow","BigNumber.from",t),Z.from(String(t));const e=t;if("bigint"==typeof e)return Z.from(e.toString());if(D(e))return Z.from(q(e));if(e)if(e.toHexString){const t=e.toHexString();if("string"==typeof t)return Z.from(t)}else{let t=e._hex;if(null==t&&"BigNumber"===e.type&&(t=e.hex),"string"==typeof t&&(C(t)||"-"===t[0]&&C(t.substring(1))))return Z.from(t)}return $.throwArgumentError("invalid BigNumber value","value",t)}static isBigNumber(t){return!(!t||!t._isBigNumber)}}function Y(t){if("string"!=typeof t)return Y(t.toString(16));if("-"===t[0])return"-"===(t=t.substring(1))[0]&&$.throwArgumentError("invalid hex","value",t),"0x00"===(t=Y(t))?t:"-"+t;if("0x"!==t.substring(0,2)&&(t="0x"+t),"0x"===t)return"0x00";for(t.length%2&&(t="0x0"+t.substring(2));t.length>4&&"0x00"===t.substring(0,4);)t="0x"+t.substring(4);return t}function Q(t){return Z.from(Y(t))}function J(t){const e=Z.from(t).toHexString();return"-"===e[0]?new j("-"+e.substring(3),16):new j(e.substring(2),16)}function tt(t,e,n){const i={fault:t,operation:e};return null!=n&&(i.value=n),$.throwError(t,O.errors.NUMERIC_FAULT,i)}const et=new O(V),nt={},it=Z.from(0),rt=Z.from(-1);function st(t,e,n,i){const r={fault:e,operation:n};return void 0!==i&&(r.value=i),et.throwError(t,O.errors.NUMERIC_FAULT,r)}let ot="0";for(;ot.length<256;)ot+=ot;function at(t){if("number"!=typeof t)try{t=Z.from(t).toNumber()}catch(t){}return"number"==typeof t&&t>=0&&t<=256&&!(t%1)?"1"+ot.substring(0,t):et.throwArgumentError("invalid decimal size","decimals",t)}function lt(t,e){null==e&&(e=0);const n=at(e),i=(t=Z.from(t)).lt(it);i&&(t=t.mul(rt));let r=t.mod(n).toString();for(;r.length<n.length-1;)r="0"+r;r=r.match(/^([0-9]*[1-9]|0)(0*)/)[1];const s=t.div(n).toString();return t=1===n.length?s:s+"."+r,i&&(t="-"+t),t}function ht(t,e){null==e&&(e=0);const n=at(e);"string"==typeof t&&t.match(/^-?[0-9.]+$/)||et.throwArgumentError("invalid decimal value","value",t);const i="-"===t.substring(0,1);i&&(t=t.substring(1)),"."===t&&et.throwArgumentError("missing value","value",t);const r=t.split(".");r.length>2&&et.throwArgumentError("too many decimal points","value",t);let s=r[0],o=r[1];for(s||(s="0"),o||(o="0");"0"===o[o.length-1];)o=o.substring(0,o.length-1);for(o.length>n.length-1&&st("fractional component exceeds decimals","underflow","parseFixed"),""===o&&(o="0");o.length<n.length-1;)o+="0";const a=Z.from(s),l=Z.from(o);let h=a.mul(n).add(l);return i&&(h=h.mul(rt)),h}class ut{constructor(t,e,n,i){t!==nt&&et.throwError("cannot use FixedFormat constructor; use FixedFormat.from",O.errors.UNSUPPORTED_OPERATION,{operation:"new FixedFormat"}),this.signed=e,this.width=n,this.decimals=i,this.name=(e?"":"u")+"fixed"+String(n)+"x"+String(i),this._multiplier=at(i),Object.freeze(this)}static from(t){if(t instanceof ut)return t;"number"==typeof t&&(t=`fixed128x${t}`);let e=!0,n=128,i=18;if("string"==typeof t)if("fixed"===t);else if("ufixed"===t)e=!1;else{const r=t.match(/^(u?)fixed([0-9]+)x([0-9]+)$/);r||et.throwArgumentError("invalid fixed format","format",t),e="u"!==r[1],n=parseInt(r[2]),i=parseInt(r[3])}else if(t){const r=(e,n,i)=>null==t[e]?i:(typeof t[e]!==n&&et.throwArgumentError("invalid fixed format ("+e+" not "+n+")","format."+e,t[e]),t[e]);e=r("signed","boolean",e),n=r("width","number",n),i=r("decimals","number",i)}return n%8&&et.throwArgumentError("invalid fixed format width (not byte aligned)","format.width",n),i>80&&et.throwArgumentError("invalid fixed format (decimals too large)","format.decimals",i),new ut(nt,e,n,i)}}class pt{constructor(t,e,n,i){t!==nt&&et.throwError("cannot use FixedNumber constructor; use FixedNumber.from",O.errors.UNSUPPORTED_OPERATION,{operation:"new FixedFormat"}),this.format=i,this._hex=e,this._value=n,this._isFixedNumber=!0,Object.freeze(this)}_checkFormat(t){this.format.name!==t.format.name&&et.throwArgumentError("incompatible format; use fixedNumber.toFormat","other",t)}addUnsafe(t){this._checkFormat(t);const e=ht(this._value,this.format.decimals),n=ht(t._value,t.format.decimals);return pt.fromValue(e.add(n),this.format.decimals,this.format)}subUnsafe(t){this._checkFormat(t);const e=ht(this._value,this.format.decimals),n=ht(t._value,t.format.decimals);return pt.fromValue(e.sub(n),this.format.decimals,this.format)}mulUnsafe(t){this._checkFormat(t);const e=ht(this._value,this.format.decimals),n=ht(t._value,t.format.decimals);return pt.fromValue(e.mul(n).div(this.format._multiplier),this.format.decimals,this.format)}divUnsafe(t){this._checkFormat(t);const e=ht(this._value,this.format.decimals),n=ht(t._value,t.format.decimals);return pt.fromValue(e.mul(this.format._multiplier).div(n),this.format.decimals,this.format)}floor(){const t=this.toString().split(".");1===t.length&&t.push("0");let e=pt.from(t[0],this.format);const n=!t[1].match(/^(0*)$/);return this.isNegative()&&n&&(e=e.subUnsafe(dt.toFormat(e.format))),e}ceiling(){const t=this.toString().split(".");1===t.length&&t.push("0");let e=pt.from(t[0],this.format);const n=!t[1].match(/^(0*)$/);return!this.isNegative()&&n&&(e=e.addUnsafe(dt.toFormat(e.format))),e}round(t){null==t&&(t=0);const e=this.toString().split(".");if(1===e.length&&e.push("0"),(t<0||t>80||t%1)&&et.throwArgumentError("invalid decimal count","decimals",t),e[1].length<=t)return this;const n=pt.from("1"+ot.substring(0,t),this.format),i=ct.toFormat(this.format);return this.mulUnsafe(n).addUnsafe(i).floor().divUnsafe(n)}isZero(){return"0.0"===this._value||"0"===this._value}isNegative(){return"-"===this._value[0]}toString(){return this._value}toHexString(t){if(null==t)return this._hex;t%8&&et.throwArgumentError("invalid byte width","width",t);return W(Z.from(this._hex).fromTwos(this.format.width).toTwos(t).toHexString(),t/8)}toUnsafeFloat(){return parseFloat(this.toString())}toFormat(t){return pt.fromString(this._value,t)}static fromValue(t,e,n){return null!=n||null==e||function(t){return null!=t&&(Z.isBigNumber(t)||"number"==typeof t&&t%1==0||"string"==typeof t&&!!t.match(/^-?[0-9]+$/)||C(t)||"bigint"==typeof t||D(t))}(e)||(n=e,e=null),null==e&&(e=0),null==n&&(n="fixed"),pt.fromString(lt(t,e),ut.from(n))}static fromString(t,e){null==e&&(e="fixed");const n=ut.from(e),i=ht(t,n.decimals);!n.signed&&i.lt(it)&&st("unsigned value cannot be negative","overflow","value",t);let r=null;n.signed?r=i.toTwos(n.width).toHexString():(r=i.toHexString(),r=W(r,n.width/8));const s=lt(i,n.decimals);return new pt(nt,r,s,n)}static fromBytes(t,e){null==e&&(e="fixed");const n=ut.from(e);if(L(t).length>n.width/8)throw new Error("overflow");let i=Z.from(t);n.signed&&(i=i.fromTwos(n.width));const r=i.toTwos((n.signed?0:1)+n.width).toHexString(),s=lt(i,n.decimals);return new pt(nt,r,s,n)}static from(t,e){if("string"==typeof t)return pt.fromString(t,e);if(D(t))return pt.fromBytes(t,e);try{return pt.fromValue(t,0,e)}catch(t){if(t.code!==O.errors.INVALID_ARGUMENT)throw t}return et.throwArgumentError("invalid FixedNumber value","value",t)}static isFixedNumber(t){return!(!t||!t._isFixedNumber)}}const dt=pt.from(1),ct=pt.from("0.5");const mt=t=>ft(t,18),ft=(t,e)=>{const n=t.split(".");n[0]=n[0]||"",n[1]=n[1]||"";const i=e-n[1].length;let r=`${"0"!==n[0]?n[0]:""}${n[1]}`;for(let t=0;t<i;t++)r+="0";return BigInt(r)},gt=1000000000000000000n,yt=1000000000000000000000000000n,wt=2000000000000000000n,vt=4000000000000000000n,Tt=mt("0.99"),bt=(t,e)=>{if(!t)throw new Error(e)};class Et{static max(t,e){return t>=e?t:e}static min(t,e){return t<e?t:e}static mulDownFixed(t,e){return t*e/gt}static mulUpFixed(t,e){const n=t*e;return 0n==n?0n:(n-1n)/gt+1n}static divDownFixed(t,e){if(0n==t)return 0n;return t*gt/e}static divUpFixed(t,e){if(0n==t)return 0n;return(t*gt-1n)/e+1n}static divUp(t,e){return 0n==t?0n:1n+(t-1n)/e}static powUpFixed(t,e,n){if(e===gt&&1!==n)return t;if(e===wt&&1!==n)return this.mulUpFixed(t,t);if(e===vt&&1!==n){const e=this.mulUpFixed(t,t);return this.mulUpFixed(e,e)}{const n=Mt.pow(t,e);return n+(this.mulUpFixed(n,this.MAX_POW_RELATIVE_ERROR)+1n)}}static powDownFixed(t,e,n){if(e===gt&&1!==n)return t;if(e===wt&&1!==n)return this.mulUpFixed(t,t);if(e===vt&&1!==n){const e=this.mulUpFixed(t,t);return this.mulUpFixed(e,e)}{const n=Mt.pow(t,e),i=this.mulUpFixed(n,this.MAX_POW_RELATIVE_ERROR)+1n;return n<i?0n:n-i}}static complementFixed(t){return t<gt?gt-t:0n}}Et.MAX_POW_RELATIVE_ERROR=10000n;class Mt{static pow(t,e){if(0n===e)return this.ONE_18;if(0n==t)return 0n;bt(t<BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819968"),"Errors.X_OUT_OF_BOUNDS");const n=t;bt(e<this.MILD_EXPONENT_BOUND,"Errors.Y_OUT_OF_BOUNDS");const i=e;let r;if(this.LN_36_LOWER_BOUND<n&&n<this.LN_36_UPPER_BOUND){const t=this._ln_36(n);r=t/this.ONE_18*i+t%this.ONE_18*i/this.ONE_18}else r=this._ln(n)*i;return r/=this.ONE_18,bt(this.MIN_NATURAL_EXPONENT<=r&&r<=this.MAX_NATURAL_EXPONENT,"Errors.PRODUCT_OUT_OF_BOUNDS"),this.exp(r)}static exp(t){if(bt(t>=this.MIN_NATURAL_EXPONENT&&t<=this.MAX_NATURAL_EXPONENT,"Errors.INVALID_EXPONENT"),t<0)return this.ONE_18*this.ONE_18/this.exp(BigInt(-1)*t);let e;t>=this.x0?(t-=this.x0,e=this.a0):t>=this.x1?(t-=this.x1,e=this.a1):e=BigInt(1),t*=BigInt(100);let n=this.ONE_20;t>=this.x2&&(t-=this.x2,n=n*this.a2/this.ONE_20),t>=this.x3&&(t-=this.x3,n=n*this.a3/this.ONE_20),t>=this.x4&&(t-=this.x4,n=n*this.a4/this.ONE_20),t>=this.x5&&(t-=this.x5,n=n*this.a5/this.ONE_20),t>=this.x6&&(t-=this.x6,n=n*this.a6/this.ONE_20),t>=this.x7&&(t-=this.x7,n=n*this.a7/this.ONE_20),t>=this.x8&&(t-=this.x8,n=n*this.a8/this.ONE_20),t>=this.x9&&(t-=this.x9,n=n*this.a9/this.ONE_20);let i,r=this.ONE_20;return i=t,r+=i,i=i*t/this.ONE_20/BigInt(2),r+=i,i=i*t/this.ONE_20/BigInt(3),r+=i,i=i*t/this.ONE_20/BigInt(4),r+=i,i=i*t/this.ONE_20/BigInt(5),r+=i,i=i*t/this.ONE_20/BigInt(6),r+=i,i=i*t/this.ONE_20/BigInt(7),r+=i,i=i*t/this.ONE_20/BigInt(8),r+=i,i=i*t/this.ONE_20/BigInt(9),r+=i,i=i*t/this.ONE_20/BigInt(10),r+=i,i=i*t/this.ONE_20/BigInt(11),r+=i,i=i*t/this.ONE_20/BigInt(12),r+=i,n*r/this.ONE_20*e/BigInt(100)}static _ln_36(t){const e=((t*=this.ONE_18)-this.ONE_36)*this.ONE_36/(t+this.ONE_36),n=e*e/this.ONE_36;let i=e,r=i;return i=i*n/this.ONE_36,r+=i/BigInt(3),i=i*n/this.ONE_36,r+=i/BigInt(5),i=i*n/this.ONE_36,r+=i/BigInt(7),i=i*n/this.ONE_36,r+=i/BigInt(9),i=i*n/this.ONE_36,r+=i/BigInt(11),i=i*n/this.ONE_36,r+=i/BigInt(13),i=i*n/this.ONE_36,r+=i/BigInt(15),r*BigInt(2)}static _ln(t){if(t<this.ONE_18)return BigInt(-1)*this._ln(this.ONE_18*this.ONE_18/t);let e=0n;t>=this.a0*this.ONE_18&&(t/=this.a0,e+=this.x0),t>=this.a1*this.ONE_18&&(t/=this.a1,e+=this.x1),e*=BigInt(100),(t*=BigInt(100))>=this.a2&&(t=t*this.ONE_20/this.a2,e+=this.x2),t>=this.a3&&(t=t*this.ONE_20/this.a3,e+=this.x3),t>=this.a4&&(t=t*this.ONE_20/this.a4,e+=this.x4),t>=this.a5&&(t=t*this.ONE_20/this.a5,e+=this.x5),t>=this.a6&&(t=t*this.ONE_20/this.a6,e+=this.x6),t>=this.a7&&(t=t*this.ONE_20/this.a7,e+=this.x7),t>=this.a8&&(t=t*this.ONE_20/this.a8,e+=this.x8),t>=this.a9&&(t=t*this.ONE_20/this.a9,e+=this.x9),t>=this.a10&&(t=t*this.ONE_20/this.a10,e+=this.x10),t>=this.a11&&(t=t*this.ONE_20/this.a11,e+=this.x11);const n=(t-this.ONE_20)*this.ONE_20/(t+this.ONE_20),i=n*n/this.ONE_20;let r=n,s=r;return r=r*i/this.ONE_20,s+=r/BigInt(3),r=r*i/this.ONE_20,s+=r/BigInt(5),r=r*i/this.ONE_20,s+=r/BigInt(7),r=r*i/this.ONE_20,s+=r/BigInt(9),r=r*i/this.ONE_20,s+=r/BigInt(11),s*=BigInt(2),(e+s)/BigInt(100)}}Mt.ONE_18=BigInt("1000000000000000000"),Mt.ONE_20=BigInt("100000000000000000000"),Mt.ONE_36=BigInt("1000000000000000000000000000000000000"),Mt.MAX_NATURAL_EXPONENT=BigInt("130000000000000000000"),Mt.MIN_NATURAL_EXPONENT=BigInt("-41000000000000000000"),Mt.LN_36_LOWER_BOUND=BigInt(Mt.ONE_18)-BigInt("100000000000000000"),Mt.LN_36_UPPER_BOUND=BigInt(Mt.ONE_18)+BigInt("100000000000000000"),Mt.MILD_EXPONENT_BOUND=BigInt(2)**BigInt(254)/Mt.ONE_20,Mt.x0=BigInt("128000000000000000000"),Mt.a0=BigInt("38877084059945950922200000000000000000000000000000000000"),Mt.x1=BigInt("64000000000000000000"),Mt.a1=BigInt("6235149080811616882910000000"),Mt.x2=BigInt("3200000000000000000000"),Mt.a2=BigInt("7896296018268069516100000000000000"),Mt.x3=BigInt("1600000000000000000000"),Mt.a3=BigInt("888611052050787263676000000"),Mt.x4=BigInt("800000000000000000000"),Mt.a4=BigInt("298095798704172827474000"),Mt.x5=BigInt("400000000000000000000"),Mt.a5=BigInt("5459815003314423907810"),Mt.x6=BigInt("200000000000000000000"),Mt.a6=BigInt("738905609893065022723"),Mt.x7=BigInt("100000000000000000000"),Mt.a7=BigInt("271828182845904523536"),Mt.x8=BigInt("50000000000000000000"),Mt.a8=BigInt("164872127070012814685"),Mt.x9=BigInt("25000000000000000000"),Mt.a9=BigInt("128402541668774148407"),Mt.x10=BigInt("12500000000000000000"),Mt.a10=BigInt("113314845306682631683"),Mt.x11=BigInt("6250000000000000000"),Mt.a11=BigInt("106449445891785942956");const kt=t=>{if(66!==t.length)throw new Error("Invalid poolId length");return t.slice(0,42).toLowerCase()};function It(t){return t.includes("Linear")}function Pt(t){return"PhantomStable"===t||It(t)}function xt(t){return"ComposableStable"===t}function _t(t){return"Element"===t}var At,Nt;!function(t){t[t.TOTAL_SUPPLY=0]="TOTAL_SUPPLY",t[t.VIRTUAL_SUPPLY=1]="VIRTUAL_SUPPLY",t[t.ACTUAL_SUPPLY=2]="ACTUAL_SUPPLY"}(At||(At={})),function(t){t[t.SWAP_FEE_PERCENTAGE=0]="SWAP_FEE_PERCENTAGE",t[t.PERCENT_FEE=1]="PERCENT_FEE"}(Nt||(Nt={}));class Ft{constructor(e,n,i){this.rpcUrl=e,this.sorQueriesAddress=n,this.sorQueriesInterface=new t(p),this.config={loadTokenBalances:"updates-after-block",blockNumber:0,loadTotalSupply:!0,loadLinearWrappedTokenRates:!0,loadSwapFees:!0,loadAmpForPools:{},loadScalingFactorForPools:{},loadWeightsForPools:{},...i}}async fetchAdditionalPoolData(t,e){if(0===t.pools.length)return[];const{poolIds:n,weightedPoolIdxs:i,ampPoolIdxs:r,linearPoolIdxs:s,totalSupplyTypes:o,scalingFactorPoolIdxs:a,swapFeeTypes:l}=this.getPoolDataQueryParams(t),{balances:h,amps:u,linearWrappedTokenRates:p,totalSupplies:d,weights:c,scalingFactors:m,swapFees:f}=await this.fetchOnChainPoolData({poolIds:n,config:{loadTokenBalancesUpdatesAfterBlock:"none"!==this.config.loadTokenBalances,loadTotalSupply:this.config.loadTotalSupply,loadSwapFees:this.config.loadSwapFees,loadLinearWrappedTokenRates:this.config.loadLinearWrappedTokenRates,loadNormalizedWeights:i.length>0,loadScalingFactors:a.length>0,loadAmps:r.length>0,blockNumber:t.syncedToBlockNumber&&"updates-after-block"===this.config.loadTokenBalances?t.syncedToBlockNumber:0,totalSupplyTypes:o,swapFeeTypes:l,linearPoolIdxs:s,weightedPoolIdxs:i,scalingFactorPoolIdxs:a,ampPoolIdxs:r},options:e});return n.map(((t,e)=>({id:n[e],balances:h[e],totalSupply:d[e],weights:i.includes(e)?c[i.indexOf(e)]:void 0,amp:r.includes(e)?u[r.indexOf(e)]:void 0,wrappedTokenRate:s.includes(e)?p[s.indexOf(e)]:void 0,scalingFactors:m[e],swapFee:f[e]})))}enrichPoolsWithData(t,e){return t.map((t=>{const n=e.find((e=>e.id===t.id));return{...t,tokens:t.tokens.map(((e,i)=>({...e,balance:n?.balances&&n.balances.length>0?lt(n.balances[i],e.decimals):e.balance,priceRate:this.getPoolTokenRate({pool:t,token:e,data:n,index:i}),weight:n?.weights?lt(n.weights[i],18):e.weight}))),totalShares:n?.totalSupply?lt(n.totalSupply,18):t.totalShares,amp:n?.amp?lt(n.amp,3).split(".")[0]:"amp"in t?t.amp:void 0,swapFee:n?.swapFee?lt(n.swapFee,18):t.swapFee}}))}getPoolDataQueryParams(t){const e=[],n=[],i=[],r=[],s=[],o=[],a=[],{loadScalingFactorForPoolTypes:l,loadScalingFactorForPoolIds:h,loadWeightsForPoolTypes:u,loadAmpForPoolTypes:p,loadAmpForPoolIds:d,loadWeightsForPoolIds:c}=this.getMergedFilterConfig(t);for(let m=0;m<t.pools.length;m++){const f=t.pools[m];e.push(f.id),n.push(Pt(f.poolType)?At.VIRTUAL_SUPPLY:xt(f.poolType)?At.ACTUAL_SUPPLY:At.TOTAL_SUPPLY),It(f.poolType)&&i.push(m),(u.has(f.poolType)||c.has(f.id))&&r.push(m),(p.has(f.poolType)||d.has(f.id))&&s.push(m),(h.has(f.id)||l.has(f.poolType))&&o.push(m),this.config.loadSwapFees&&a.push(_t(f.poolType)?Nt.PERCENT_FEE:Nt.SWAP_FEE_PERCENTAGE)}return{poolIds:e,totalSupplyTypes:n,linearPoolIdxs:i,weightedPoolIdxs:r,ampPoolIdxs:s,scalingFactorPoolIdxs:o,swapFeeTypes:a}}getMergedFilterConfig({poolsWithActiveWeightUpdates:t=[],poolsWithActiveAmpUpdates:e=[]}){const{loadWeightsForPools:n,loadScalingFactorForPools:i,loadAmpForPools:r}=this.config;return{loadWeightsForPoolIds:new Set([...t,...n.poolIds||[]]),loadAmpForPoolIds:new Set([...e,...r.poolIds||[]]),loadScalingFactorForPoolIds:new Set(i.poolIds||[]),loadWeightsForPoolTypes:new Set(n.poolTypes||[]),loadAmpForPoolTypes:new Set(r.poolTypes||[]),loadScalingFactorForPoolTypes:new Set(i.poolTypes||[])}}async fetchOnChainPoolData({poolIds:t,config:e,options:n}){return async function({rpcUrl:t,from:e=c,to:n,contractInterface:r,functionFragment:s,values:o,options:a}){const l=r.encodeFunctionData(s,o);let h;h=a?.block?q(a.block):"latest";const u=await i(t,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:2,method:"eth_call",params:[{from:e,to:n,data:l},h]})}),p=await u.json();return r.decodeFunctionResult("getPoolData",p.result)}({rpcUrl:this.rpcUrl,to:this.sorQueriesAddress,contractInterface:this.sorQueriesInterface,functionFragment:"getPoolData",values:[t,e],options:n})}getPoolTokenRate({pool:t,token:e,data:n,index:i}){return n?.wrappedTokenRate&&"wrappedIndex"in t&&t.wrappedIndex===i?lt(n.wrappedTokenRate,18):n?.scalingFactors?lt(n.scalingFactors[i],18):e.priceRate}}const Ot=3600;class St{constructor(t,e){this.client=new r(t);const n=e&&(e.poolIdNotIn||e.poolIdIn||e.poolTypeIn||e.poolTypeNotIn);this.config={retries:2,timeout:3e4,loadActiveAmpUpdates:!0,addFilterToPoolQuery:!1,poolTypeNotIn:n?void 0:["Investment","LiquidityBootstrapping"],...e}}async getPools(t){const e=await async function(t,e={timeout:3e4,retries:2}){let n=null;return await o((async()=>{const i=new a;try{const r=t(),s=i.set(e.timeout).then((()=>{throw new Error(`Timed out during fetchWithRetry: ${e.timeout}`)}));return void(n=await Promise.race([r,s]))}finally{i.clear()}}),{retries:e.retries,onRetry:(t,e)=>{}}),n}((()=>this.fetchDataFromSubgraph(t)));return{...e,pools:e?.pools||[],syncedToBlockNumber:e?.syncedToBlockNumber||0}}async fetchDataFromSubgraph(t){let e=[],n=0,i="",r=[],s=[];const o=Math.round((t.timestamp-Ot)/Ot)*Ot,a=Math.round((t.timestamp+Ot)/Ot)*Ot;do{const l=await this.client.request(this.getPoolsQuery(""===i),{pageSize:1e3,where:{id:i||void 0,...this.config.addFilterToPoolQuery?{totalShares_gt:1e-12,swapEnabled:!0,poolType_in:this.config.poolTypeIn,poolType_not_in:this.config.poolTypeNotIn,id_in:this.config.poolIdIn,id_not_in:this.config.poolIdNotIn}:{}},...t?.block?{block:{number:t.block}}:{},ampUpdatesWhere:{endTimestamp_gte:o,startTimestamp_lte:a},weightedUpdatesWhere:{endTimestamp_gte:o,startTimestamp_lte:a}});s=l.pools,r=r.concat(s),""===i&&(e=l.ampUpdates||[]),l._meta&&(n=l._meta.block.number),i=r[r.length-1].id}while(1e3===s.length);return this.config.addFilterToPoolQuery||(r=r.filter((t=>this.poolMatchesFilter(t)))),{pools:r,poolsWithActiveAmpUpdates:e.map((t=>t.poolId.id)),syncedToBlockNumber:n}}getPoolsQuery(t){const{loadActiveAmpUpdates:e,loadActiveWeightUpdates:n,gqlAdditionalPoolQueryFields:i}=this.config;return s`
            query poolsQuery(
                $pageSize: Int!
                $where: Pool_filter
                $block: Block_height
                $ampUpdatesWhere: AmpUpdate_filter
                $weightedUpdatesWhere: GradualWeightUpdate_filter
            ) {
                pools(first: $pageSize, where: $where, block: $block) {
                    id
                    address
                    poolType
                    poolTypeVersion
                    tokens {
                        address
                        balance
                        weight
                        priceRate
                        decimals
                        name
                        index
                        symbol
                    }
                    tokensList
                    swapEnabled
                    swapFee
                    amp
                    totalLiquidity
                    totalShares
                    mainIndex
                    wrappedIndex
                    lowerTarget
                    upperTarget
                    ${i||""}
                }
                ${t?"\n            _meta {\n                block {\n                    number\n                }\n            }\n        ":""}
                ${t&&e?"\n            ampUpdates(where: $ampUpdatesWhere) {\n                poolId {\n                    id\n                }\n            }\n        ":""}
                ${t&&n?"\n            gradualWeightUpdates(where: $weightedUpdatesWhere) {\n                poolId {\n                    id\n                }\n            }\n        ":""}
            }
        `}poolMatchesFilter(t){return!(!t.swapEnabled||"0.000000000001"===t.totalShares||"0.0"===t.totalShares)&&(!(this.config.poolTypeIn&&!this.config.poolTypeIn.includes(t.poolType))&&((!this.config.poolTypeNotIn||!this.config.poolTypeNotIn.includes(t.poolType))&&(!(this.config.poolIdIn&&!this.config.poolIdIn.includes(t.id))&&(!this.config.poolIdNotIn||!this.config.poolIdNotIn.includes(t.id)))))}}var Rt,Bt;!function(t){t.Weighted="Weighted",t.ComposableStable="ComposableStable",t.MetaStable="MetaStable",t.AaveLinear="AaveLinear"}(Rt||(Rt={})),function(t){t[t.GivenIn=0]="GivenIn",t[t.GivenOut=1]="GivenOut"}(Bt||(Bt={}));class Ut{constructor(t,e){if(0===e.length||t.length<2)throw new Error("Invalid path: must contain at least 1 pool and 2 tokens.");if(t.length!==e.length+1)throw new Error("Invalid path: tokens length must equal pools length + 1");this.pools=e,this.tokens=t}}class Dt extends Ut{constructor(t,e,n){super(t,e),this.swapAmount=n,t[0].address===n.token.wrapped?this.swapKind=Bt.GivenIn:this.swapKind=Bt.GivenOut;try{this.outputAmount=this.calcOutputAmount(),this.inputAmount=this.calcInputAmount()}catch(t){throw new Error("Invalid path, swap amount exceeds maximum for pool")}}calcOutputAmount(){if(this.swapKind===Bt.GivenIn){const t=new Array(this.tokens.length);t[0]=this.swapAmount;for(let e=0;e<this.pools.length;e++){const n=this.pools[e].swapGivenIn(this.tokens[e],this.tokens[e+1],t[e]);t[e+1]=n}return t[t.length-1]}return this.swapAmount}calcInputAmount(){if(this.swapKind===Bt.GivenOut){const t=new Array(this.tokens.length);t[t.length-1]=this.swapAmount;for(let e=this.pools.length;e>=1;e--){const n=this.pools[e-1].swapGivenOut(this.tokens[e-1],this.tokens[e],t[e]);t[e-1]=n}return t[0]}return this.swapAmount}print(){const t=[];let e=[];if(this.swapKind===Bt.GivenIn){const e=new Array(this.tokens.length);e[0]=this.swapAmount;for(let n=0;n<this.pools.length;n++){const i=this.pools[n],r=i.swapGivenIn(this.tokens[n],this.tokens[n+1],e[n]);e[n+1]=r,t.push({pool:i.id,input:e[n].amount.toString()+" "+this.tokens[n].symbol,output:r.amount.toString()+" "+this.tokens[n+1].symbol})}console.table(t)}else{const n=new Array(this.tokens.length);n[n.length-1]=this.swapAmount;for(let e=this.pools.length;e>=1;e--){const i=this.pools[e-1],r=i.swapGivenOut(this.tokens[e-1],this.tokens[e],n[e]);n[e-1]=r,t.push({pool:i.id,input:r.amount.toString()+" "+this.tokens[e-1].symbol,output:n[e].amount.toString()+" "+this.tokens[e].symbol})}e=t.reverse(),console.table(e)}}}var Lt=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{l(i.next(t))}catch(t){s(t)}}function a(t){try{l(i.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))};const Ct=new O("properties/5.7.0");function Gt(t,e,n){Object.defineProperty(t,e,{enumerable:!0,value:n,writable:!1})}function qt(t){return Lt(this,void 0,void 0,(function*(){const e=Object.keys(t).map((e=>{const n=t[e];return Promise.resolve(n).then((t=>({key:e,value:t})))}));return(yield Promise.all(e)).reduce(((t,e)=>(t[e.key]=e.value,t)),{})}))}function Wt(t){const e={};for(const n in t)e[n]=t[n];return e}const zt={bigint:!0,boolean:!0,function:!0,number:!0,string:!0};function Vt(t){if(null==t||zt[typeof t])return!0;if(Array.isArray(t)||"object"==typeof t){if(!Object.isFrozen(t))return!1;const e=Object.keys(t);for(let n=0;n<e.length;n++){let i=null;try{i=t[e[n]]}catch(t){continue}if(!Vt(i))return!1}return!0}return Ct.throwArgumentError("Cannot deepCopy "+typeof t,"object",t)}function jt(t){if(Vt(t))return t;if(Array.isArray(t))return Object.freeze(t.map((t=>$t(t))));if("object"==typeof t){const e={};for(const n in t){const i=t[n];void 0!==i&&Gt(e,n,$t(i))}return e}return Ct.throwArgumentError("Cannot deepCopy "+typeof t,"object",t)}function $t(t){return jt(t)}var Ht=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{l(i.next(t))}catch(t){s(t)}}function a(t){try{l(i.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))};const Kt=new O("abstract-provider/5.7.0");class Xt{constructor(){Kt.checkAbstract(new.target,Xt),Gt(this,"_isProvider",!0)}getFeeData(){return Ht(this,void 0,void 0,(function*(){const{block:t,gasPrice:e}=yield qt({block:this.getBlock("latest"),gasPrice:this.getGasPrice().catch((t=>null))});let n=null,i=null,r=null;return t&&t.baseFeePerGas&&(n=t.baseFeePerGas,r=Z.from("1500000000"),i=t.baseFeePerGas.mul(2).add(r)),{lastBaseFeePerGas:n,maxFeePerGas:i,maxPriorityFeePerGas:r,gasPrice:e}}))}addListener(t,e){return this.on(t,e)}removeListener(t,e){return this.off(t,e)}static isProvider(t){return!(!t||!t._isProvider)}}var Zt=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{l(i.next(t))}catch(t){s(t)}}function a(t){try{l(i.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))};const Yt=new O("abstract-signer/5.7.0"),Qt=["accessList","ccipReadEnabled","chainId","customData","data","from","gasLimit","gasPrice","maxFeePerGas","maxPriorityFeePerGas","nonce","to","type","value"],Jt=[O.errors.INSUFFICIENT_FUNDS,O.errors.NONCE_EXPIRED,O.errors.REPLACEMENT_UNDERPRICED];class te{constructor(){Yt.checkAbstract(new.target,te),Gt(this,"_isSigner",!0)}getBalance(t){return Zt(this,void 0,void 0,(function*(){return this._checkProvider("getBalance"),yield this.provider.getBalance(this.getAddress(),t)}))}getTransactionCount(t){return Zt(this,void 0,void 0,(function*(){return this._checkProvider("getTransactionCount"),yield this.provider.getTransactionCount(this.getAddress(),t)}))}estimateGas(t){return Zt(this,void 0,void 0,(function*(){this._checkProvider("estimateGas");const e=yield qt(this.checkTransaction(t));return yield this.provider.estimateGas(e)}))}call(t,e){return Zt(this,void 0,void 0,(function*(){this._checkProvider("call");const n=yield qt(this.checkTransaction(t));return yield this.provider.call(n,e)}))}sendTransaction(t){return Zt(this,void 0,void 0,(function*(){this._checkProvider("sendTransaction");const e=yield this.populateTransaction(t),n=yield this.signTransaction(e);return yield this.provider.sendTransaction(n)}))}getChainId(){return Zt(this,void 0,void 0,(function*(){this._checkProvider("getChainId");return(yield this.provider.getNetwork()).chainId}))}getGasPrice(){return Zt(this,void 0,void 0,(function*(){return this._checkProvider("getGasPrice"),yield this.provider.getGasPrice()}))}getFeeData(){return Zt(this,void 0,void 0,(function*(){return this._checkProvider("getFeeData"),yield this.provider.getFeeData()}))}resolveName(t){return Zt(this,void 0,void 0,(function*(){return this._checkProvider("resolveName"),yield this.provider.resolveName(t)}))}checkTransaction(t){for(const e in t)-1===Qt.indexOf(e)&&Yt.throwArgumentError("invalid transaction key: "+e,"transaction",t);const e=Wt(t);return null==e.from?e.from=this.getAddress():e.from=Promise.all([Promise.resolve(e.from),this.getAddress()]).then((e=>(e[0].toLowerCase()!==e[1].toLowerCase()&&Yt.throwArgumentError("from address mismatch","transaction",t),e[0]))),e}populateTransaction(t){return Zt(this,void 0,void 0,(function*(){const e=yield qt(this.checkTransaction(t));null!=e.to&&(e.to=Promise.resolve(e.to).then((t=>Zt(this,void 0,void 0,(function*(){if(null==t)return null;const e=yield this.resolveName(t);return null==e&&Yt.throwArgumentError("provided ENS name resolves to null","tx.to",t),e})))),e.to.catch((t=>{})));const n=null!=e.maxFeePerGas||null!=e.maxPriorityFeePerGas;if(null==e.gasPrice||2!==e.type&&!n?0!==e.type&&1!==e.type||!n||Yt.throwArgumentError("pre-eip-1559 transaction do not support maxFeePerGas/maxPriorityFeePerGas","transaction",t):Yt.throwArgumentError("eip-1559 transaction do not support gasPrice","transaction",t),2!==e.type&&null!=e.type||null==e.maxFeePerGas||null==e.maxPriorityFeePerGas)if(0===e.type||1===e.type)null==e.gasPrice&&(e.gasPrice=this.getGasPrice());else{const t=yield this.getFeeData();if(null==e.type)if(null!=t.maxFeePerGas&&null!=t.maxPriorityFeePerGas)if(e.type=2,null!=e.gasPrice){const t=e.gasPrice;delete e.gasPrice,e.maxFeePerGas=t,e.maxPriorityFeePerGas=t}else null==e.maxFeePerGas&&(e.maxFeePerGas=t.maxFeePerGas),null==e.maxPriorityFeePerGas&&(e.maxPriorityFeePerGas=t.maxPriorityFeePerGas);else null!=t.gasPrice?(n&&Yt.throwError("network does not support EIP-1559",O.errors.UNSUPPORTED_OPERATION,{operation:"populateTransaction"}),null==e.gasPrice&&(e.gasPrice=t.gasPrice),e.type=0):Yt.throwError("failed to get consistent fee data",O.errors.UNSUPPORTED_OPERATION,{operation:"signer.getFeeData"});else 2===e.type&&(null==e.maxFeePerGas&&(e.maxFeePerGas=t.maxFeePerGas),null==e.maxPriorityFeePerGas&&(e.maxPriorityFeePerGas=t.maxPriorityFeePerGas))}else e.type=2;return null==e.nonce&&(e.nonce=this.getTransactionCount("pending")),null==e.gasLimit&&(e.gasLimit=this.estimateGas(e).catch((t=>{if(Jt.indexOf(t.code)>=0)throw t;return Yt.throwError("cannot estimate gas; transaction may fail or may require manual gas limit",O.errors.UNPREDICTABLE_GAS_LIMIT,{error:t,tx:e})}))),null==e.chainId?e.chainId=this.getChainId():e.chainId=Promise.all([Promise.resolve(e.chainId),this.getChainId()]).then((e=>(0!==e[1]&&e[0]!==e[1]&&Yt.throwArgumentError("chainId address mismatch","transaction",t),e[0]))),yield qt(e)}))}_checkProvider(t){this.provider||Yt.throwError("missing provider",O.errors.UNSUPPORTED_OPERATION,{operation:t||"_checkProvider"})}static isSigner(t){return!(!t||!t._isSigner)}}class ee extends te{constructor(t,e){super(),Gt(this,"address",t),Gt(this,"provider",e||null)}getAddress(){return Promise.resolve(this.address)}_fail(t,e){return Promise.resolve().then((()=>{Yt.throwError(t,O.errors.UNSUPPORTED_OPERATION,{operation:e})}))}signMessage(t){return this._fail("VoidSigner cannot sign messages","signMessage")}signTransaction(t){return this._fail("VoidSigner cannot sign transactions","signTransaction")}_signTypedData(t,e,n){return this._fail("VoidSigner cannot sign typed data","signTypedData")}connect(t){return new ee(this.address,t)}}const ne=new O("transactions/5.7.0");var ie;function re(t,e){return{address:l(t),storageKeys:(e||[]).map(((e,n)=>(32!==function(t){if("string"!=typeof t)t=q(t);else if(!C(t)||t.length%2)return null;return(t.length-2)/2}(e)&&ne.throwArgumentError("invalid access list storageKey",`accessList[${t}:${n}]`,e),e.toLowerCase())))}}!function(t){t[t.legacy=0]="legacy",t[t.eip2930=1]="eip2930",t[t.eip1559=2]="eip1559"}(ie||(ie={}));var se=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{l(i.next(t))}catch(t){s(t)}}function a(t){try{l(i.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))};const oe=new O("contracts/5.7.0");function ae(t,e){return se(this,void 0,void 0,(function*(){const n=yield e;"string"!=typeof n&&oe.throwArgumentError("invalid address or ENS name","name",n);try{return l(n)}catch(t){}t||oe.throwError("a provider or signer is needed to resolve ENS names",O.errors.UNSUPPORTED_OPERATION,{operation:"resolveName"});const i=yield t.resolveName(n);return null==i&&oe.throwArgumentError("resolver or addr is not configured for ENS name","name",n),i}))}function le(t,e,n){return se(this,void 0,void 0,(function*(){return Array.isArray(n)?yield Promise.all(n.map(((n,i)=>le(t,Array.isArray(e)?e[i]:e[n.name],n)))):"address"===n.type?yield ae(t,e):"tuple"===n.type?yield le(t,e,n.components):"array"===n.baseType?Array.isArray(e)?yield Promise.all(e.map((e=>le(t,e,n.arrayChildren)))):Promise.reject(oe.makeError("invalid value for array",O.errors.INVALID_ARGUMENT,{argument:"value",value:e})):e}))}function he(t,e,n){return se(this,void 0,void 0,(function*(){let i={};n.length===e.inputs.length+1&&"object"==typeof n[n.length-1]&&(i=Wt(n.pop())),oe.checkArgumentCount(n.length,e.inputs.length,"passed to contract"),t.signer?i.from?i.from=qt({override:ae(t.signer,i.from),signer:t.signer.getAddress()}).then((t=>se(this,void 0,void 0,(function*(){return l(t.signer)!==t.override&&oe.throwError("Contract with a Signer cannot override from",O.errors.UNSUPPORTED_OPERATION,{operation:"overrides.from"}),t.override})))):i.from=t.signer.getAddress():i.from&&(i.from=ae(t.provider,i.from));const r=yield qt({args:le(t.signer||t.provider,n,e.inputs),address:t.resolvedAddress,overrides:qt(i)||{}}),s=t.interface.encodeFunctionData(e,r.args),o={data:s,to:r.address},a=r.overrides;if(null!=a.nonce&&(o.nonce=Z.from(a.nonce).toNumber()),null!=a.gasLimit&&(o.gasLimit=Z.from(a.gasLimit)),null!=a.gasPrice&&(o.gasPrice=Z.from(a.gasPrice)),null!=a.maxFeePerGas&&(o.maxFeePerGas=Z.from(a.maxFeePerGas)),null!=a.maxPriorityFeePerGas&&(o.maxPriorityFeePerGas=Z.from(a.maxPriorityFeePerGas)),null!=a.from&&(o.from=a.from),null!=a.type&&(o.type=a.type),null!=a.accessList&&(o.accessList=function(t){if(Array.isArray(t))return t.map(((t,e)=>Array.isArray(t)?(t.length>2&&ne.throwArgumentError("access list expected to be [ address, storageKeys[] ]",`value[${e}]`,t),re(t[0],t[1])):re(t.address,t.storageKeys)));const e=Object.keys(t).map((e=>{const n=t[e].reduce(((t,e)=>(t[e]=!0,t)),{});return re(e,Object.keys(n).sort())}));return e.sort(((t,e)=>t.address.localeCompare(e.address))),e}(a.accessList)),null==o.gasLimit&&null!=e.gas){let t=21e3;const n=L(s);for(let e=0;e<n.length;e++)t+=4,n[e]&&(t+=64);o.gasLimit=Z.from(e.gas).add(t)}if(a.value){const t=Z.from(a.value);t.isZero()||e.payable||oe.throwError("non-payable method cannot override value",O.errors.UNSUPPORTED_OPERATION,{operation:"overrides.value",value:i.value}),o.value=t}a.customData&&(o.customData=Wt(a.customData)),a.ccipReadEnabled&&(o.ccipReadEnabled=!!a.ccipReadEnabled),delete i.nonce,delete i.gasLimit,delete i.gasPrice,delete i.from,delete i.value,delete i.type,delete i.accessList,delete i.maxFeePerGas,delete i.maxPriorityFeePerGas,delete i.customData,delete i.ccipReadEnabled;const h=Object.keys(i).filter((t=>null!=i[t]));return h.length&&oe.throwError(`cannot override ${h.map((t=>JSON.stringify(t))).join(",")}`,O.errors.UNSUPPORTED_OPERATION,{operation:"overrides",overrides:h}),o}))}function ue(t,e,n){const i=t.signer||t.provider;return function(...r){return se(this,void 0,void 0,(function*(){let s;if(r.length===e.inputs.length+1&&"object"==typeof r[r.length-1]){const t=Wt(r.pop());null!=t.blockTag&&(s=yield t.blockTag),delete t.blockTag,r.push(t)}null!=t.deployTransaction&&(yield t._deployed(s));const o=yield he(t,e,r),a=yield i.call(o,s);try{let i=t.interface.decodeFunctionResult(e,a);return n&&1===e.outputs.length&&(i=i[0]),i}catch(e){throw e.code===O.errors.CALL_EXCEPTION&&(e.address=t.address,e.args=r,e.transaction=o),e}}))}}function pe(t,e){return function(...n){return se(this,void 0,void 0,(function*(){t.signer||oe.throwError("sending a transaction requires a signer",O.errors.UNSUPPORTED_OPERATION,{operation:"sendTransaction"}),null!=t.deployTransaction&&(yield t._deployed());const i=yield he(t,e,n),r=yield t.signer.sendTransaction(i);return function(t,e){const n=e.wait.bind(e);e.wait=e=>n(e).then((e=>(e.events=e.logs.map((n=>{let i=$t(n),r=null;try{r=t.interface.parseLog(n)}catch(t){}return r&&(i.args=r.args,i.decode=(e,n)=>t.interface.decodeEventLog(r.eventFragment,e,n),i.event=r.name,i.eventSignature=r.signature),i.removeListener=()=>t.provider,i.getBlock=()=>t.provider.getBlock(e.blockHash),i.getTransaction=()=>t.provider.getTransaction(e.transactionHash),i.getTransactionReceipt=()=>Promise.resolve(e),i})),e)))}(t,r),r}))}}function de(t,e,n){return e.constant?ue(t,e,n):pe(t,e)}function ce(t){return!t.address||null!=t.topics&&0!==t.topics.length?(t.address||"*")+"@"+(t.topics?t.topics.map((t=>Array.isArray(t)?t.join("|"):t)).join(":"):""):"*"}class me{constructor(t,e){Gt(this,"tag",t),Gt(this,"filter",e),this._listeners=[]}addListener(t,e){this._listeners.push({listener:t,once:e})}removeListener(t){let e=!1;this._listeners=this._listeners.filter((n=>!(!e&&n.listener===t)||(e=!0,!1)))}removeAllListeners(){this._listeners=[]}listeners(){return this._listeners.map((t=>t.listener))}listenerCount(){return this._listeners.length}run(t){const e=this.listenerCount();return this._listeners=this._listeners.filter((e=>{const n=t.slice();return setTimeout((()=>{e.listener.apply(this,n)}),0),!e.once})),e}prepareEvent(t){}getEmit(t){return[t]}}class fe extends me{constructor(){super("error",null)}}class ge extends me{constructor(t,e,n,i){const r={address:t};let s=e.getEventTopic(n);i?(s!==i[0]&&oe.throwArgumentError("topic mismatch","topics",i),r.topics=i.slice()):r.topics=[s],super(ce(r),r),Gt(this,"address",t),Gt(this,"interface",e),Gt(this,"fragment",n)}prepareEvent(t){super.prepareEvent(t),t.event=this.fragment.name,t.eventSignature=this.fragment.format(),t.decode=(t,e)=>this.interface.decodeEventLog(this.fragment,t,e);try{t.args=this.interface.decodeEventLog(this.fragment,t.data,t.topics)}catch(e){t.args=null,t.decodeError=e}}getEmit(t){const e=n(t.args);if(e.length)throw e[0].error;const i=(t.args||[]).slice();return i.push(t),i}}class ye extends me{constructor(t,e){super("*",{address:t}),Gt(this,"address",t),Gt(this,"interface",e)}prepareEvent(t){super.prepareEvent(t);try{const e=this.interface.parseLog(t);t.event=e.name,t.eventSignature=e.signature,t.decode=(t,n)=>this.interface.decodeEventLog(e.eventFragment,t,n),t.args=e.args}catch(t){}}}class we{constructor(t,e,n){Gt(this,"interface",function(t,e){for(let n=0;n<32;n++){if(t[e])return t[e];if(!t.prototype||"object"!=typeof t.prototype)break;t=Object.getPrototypeOf(t.prototype).constructor}return null}(new.target,"getInterface")(e)),null==n?(Gt(this,"provider",null),Gt(this,"signer",null)):te.isSigner(n)?(Gt(this,"provider",n.provider||null),Gt(this,"signer",n)):Xt.isProvider(n)?(Gt(this,"provider",n),Gt(this,"signer",null)):oe.throwArgumentError("invalid signer or provider","signerOrProvider",n),Gt(this,"callStatic",{}),Gt(this,"estimateGas",{}),Gt(this,"functions",{}),Gt(this,"populateTransaction",{}),Gt(this,"filters",{});{const t={};Object.keys(this.interface.events).forEach((e=>{const n=this.interface.events[e];Gt(this.filters,e,((...t)=>({address:this.address,topics:this.interface.encodeFilterTopics(n,t)}))),t[n.name]||(t[n.name]=[]),t[n.name].push(e)})),Object.keys(t).forEach((e=>{const n=t[e];1===n.length?Gt(this.filters,e,this.filters[n[0]]):oe.warn(`Duplicate definition of ${e} (${n.join(", ")})`)}))}if(Gt(this,"_runningEvents",{}),Gt(this,"_wrappedEmits",{}),null==t&&oe.throwArgumentError("invalid contract address or ENS name","addressOrName",t),Gt(this,"address",t),this.provider)Gt(this,"resolvedAddress",ae(this.provider,t));else try{Gt(this,"resolvedAddress",Promise.resolve(l(t)))}catch(t){oe.throwError("provider is required to use ENS name as contract address",O.errors.UNSUPPORTED_OPERATION,{operation:"new Contract"})}this.resolvedAddress.catch((t=>{}));const i={},r={};Object.keys(this.interface.functions).forEach((t=>{const e=this.interface.functions[t];if(r[t])oe.warn(`Duplicate ABI entry for ${JSON.stringify(t)}`);else{r[t]=!0;{const n=e.name;i[`%${n}`]||(i[`%${n}`]=[]),i[`%${n}`].push(t)}null==this[t]&&Gt(this,t,de(this,e,!0)),null==this.functions[t]&&Gt(this.functions,t,de(this,e,!1)),null==this.callStatic[t]&&Gt(this.callStatic,t,ue(this,e,!0)),null==this.populateTransaction[t]&&Gt(this.populateTransaction,t,function(t,e){return function(...n){return he(t,e,n)}}(this,e)),null==this.estimateGas[t]&&Gt(this.estimateGas,t,function(t,e){const n=t.signer||t.provider;return function(...i){return se(this,void 0,void 0,(function*(){n||oe.throwError("estimate require a provider or signer",O.errors.UNSUPPORTED_OPERATION,{operation:"estimateGas"});const r=yield he(t,e,i);return yield n.estimateGas(r)}))}}(this,e))}})),Object.keys(i).forEach((t=>{const e=i[t];if(e.length>1)return;t=t.substring(1);const n=e[0];try{null==this[t]&&Gt(this,t,this[n])}catch(t){}null==this.functions[t]&&Gt(this.functions,t,this.functions[n]),null==this.callStatic[t]&&Gt(this.callStatic,t,this.callStatic[n]),null==this.populateTransaction[t]&&Gt(this.populateTransaction,t,this.populateTransaction[n]),null==this.estimateGas[t]&&Gt(this.estimateGas,t,this.estimateGas[n])}))}static getContractAddress(t){return h(t)}static getInterface(e){return t.isInterface(e)?e:new t(e)}deployed(){return this._deployed()}_deployed(t){return this._deployedPromise||(this.deployTransaction?this._deployedPromise=this.deployTransaction.wait().then((()=>this)):this._deployedPromise=this.provider.getCode(this.address,t).then((t=>("0x"===t&&oe.throwError("contract not deployed",O.errors.UNSUPPORTED_OPERATION,{contractAddress:this.address,operation:"getDeployed"}),this)))),this._deployedPromise}fallback(t){this.signer||oe.throwError("sending a transactions require a signer",O.errors.UNSUPPORTED_OPERATION,{operation:"sendTransaction(fallback)"});const e=Wt(t||{});return["from","to"].forEach((function(t){null!=e[t]&&oe.throwError("cannot override "+t,O.errors.UNSUPPORTED_OPERATION,{operation:t})})),e.to=this.resolvedAddress,this.deployed().then((()=>this.signer.sendTransaction(e)))}connect(t){"string"==typeof t&&(t=new ee(t,this.provider));const e=new this.constructor(this.address,this.interface,t);return this.deployTransaction&&Gt(e,"deployTransaction",this.deployTransaction),e}attach(t){return new this.constructor(t,this.interface,this.signer||this.provider)}static isIndexed(t){return e.isIndexed(t)}_normalizeRunningEvent(t){return this._runningEvents[t.tag]?this._runningEvents[t.tag]:t}_getRunningEvent(t){if("string"==typeof t){if("error"===t)return this._normalizeRunningEvent(new fe);if("event"===t)return this._normalizeRunningEvent(new me("event",null));if("*"===t)return this._normalizeRunningEvent(new ye(this.address,this.interface));const e=this.interface.getEvent(t);return this._normalizeRunningEvent(new ge(this.address,this.interface,e))}if(t.topics&&t.topics.length>0){try{const e=t.topics[0];if("string"!=typeof e)throw new Error("invalid topic");const n=this.interface.getEvent(e);return this._normalizeRunningEvent(new ge(this.address,this.interface,n,t.topics))}catch(t){}const e={address:this.address,topics:t.topics};return this._normalizeRunningEvent(new me(ce(e),e))}return this._normalizeRunningEvent(new ye(this.address,this.interface))}_checkRunningEvents(t){if(0===t.listenerCount()){delete this._runningEvents[t.tag];const e=this._wrappedEmits[t.tag];e&&t.filter&&(this.provider.off(t.filter,e),delete this._wrappedEmits[t.tag])}}_wrapEvent(t,e,n){const i=$t(e);return i.removeListener=()=>{n&&(t.removeListener(n),this._checkRunningEvents(t))},i.getBlock=()=>this.provider.getBlock(e.blockHash),i.getTransaction=()=>this.provider.getTransaction(e.transactionHash),i.getTransactionReceipt=()=>this.provider.getTransactionReceipt(e.transactionHash),t.prepareEvent(i),i}_addEventListener(t,e,n){if(this.provider||oe.throwError("events require a provider or a signer with a provider",O.errors.UNSUPPORTED_OPERATION,{operation:"once"}),t.addListener(e,n),this._runningEvents[t.tag]=t,!this._wrappedEmits[t.tag]){const n=n=>{let i=this._wrapEvent(t,n,e);if(null==i.decodeError)try{const e=t.getEmit(i);this.emit(t.filter,...e)}catch(t){i.decodeError=t.error}null!=t.filter&&this.emit("event",i),null!=i.decodeError&&this.emit("error",i.decodeError,i)};this._wrappedEmits[t.tag]=n,null!=t.filter&&this.provider.on(t.filter,n)}}queryFilter(t,e,n){const i=this._getRunningEvent(t),r=Wt(i.filter);return"string"==typeof e&&C(e,32)?(null!=n&&oe.throwArgumentError("cannot specify toBlock with blockhash","toBlock",n),r.blockHash=e):(r.fromBlock=null!=e?e:0,r.toBlock=null!=n?n:"latest"),this.provider.getLogs(r).then((t=>t.map((t=>this._wrapEvent(i,t,null)))))}on(t,e){return this._addEventListener(this._getRunningEvent(t),e,!1),this}once(t,e){return this._addEventListener(this._getRunningEvent(t),e,!0),this}emit(t,...e){if(!this.provider)return!1;const n=this._getRunningEvent(t),i=n.run(e)>0;return this._checkRunningEvents(n),i}listenerCount(t){return this.provider?null==t?Object.keys(this._runningEvents).reduce(((t,e)=>t+this._runningEvents[e].listenerCount()),0):this._getRunningEvent(t).listenerCount():0}listeners(t){if(!this.provider)return[];if(null==t){const t=[];for(let e in this._runningEvents)this._runningEvents[e].listeners().forEach((e=>{t.push(e)}));return t}return this._getRunningEvent(t).listeners()}removeAllListeners(t){if(!this.provider)return this;if(null==t){for(const t in this._runningEvents){const e=this._runningEvents[t];e.removeAllListeners(),this._checkRunningEvents(e)}return this}const e=this._getRunningEvent(t);return e.removeAllListeners(),this._checkRunningEvents(e),this}off(t,e){if(!this.provider)return this;const n=this._getRunningEvent(t);return n.removeListener(e),this._checkRunningEvents(n),this}removeListener(t,e){return this.off(t,e)}}class ve extends we{}var Te=[{inputs:[{internalType:"contract IAuthorizer",name:"authorizer",type:"address"},{internalType:"contract IWETH",name:"weth",type:"address"},{internalType:"uint256",name:"pauseWindowDuration",type:"uint256"},{internalType:"uint256",name:"bufferPeriodDuration",type:"uint256"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"contract IAuthorizer",name:"newAuthorizer",type:"address"}],name:"AuthorizerChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"contract IERC20",name:"token",type:"address"},{indexed:!0,internalType:"address",name:"sender",type:"address"},{indexed:!1,internalType:"address",name:"recipient",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"ExternalBalanceTransfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"contract IFlashLoanRecipient",name:"recipient",type:"address"},{indexed:!0,internalType:"contract IERC20",name:"token",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"},{indexed:!1,internalType:"uint256",name:"feeAmount",type:"uint256"}],name:"FlashLoan",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"contract IERC20",name:"token",type:"address"},{indexed:!1,internalType:"int256",name:"delta",type:"int256"}],name:"InternalBalanceChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bool",name:"paused",type:"bool"}],name:"PausedStateChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"poolId",type:"bytes32"},{indexed:!0,internalType:"address",name:"liquidityProvider",type:"address"},{indexed:!1,internalType:"contract IERC20[]",name:"tokens",type:"address[]"},{indexed:!1,internalType:"int256[]",name:"deltas",type:"int256[]"},{indexed:!1,internalType:"uint256[]",name:"protocolFeeAmounts",type:"uint256[]"}],name:"PoolBalanceChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"poolId",type:"bytes32"},{indexed:!0,internalType:"address",name:"assetManager",type:"address"},{indexed:!0,internalType:"contract IERC20",name:"token",type:"address"},{indexed:!1,internalType:"int256",name:"cashDelta",type:"int256"},{indexed:!1,internalType:"int256",name:"managedDelta",type:"int256"}],name:"PoolBalanceManaged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"poolId",type:"bytes32"},{indexed:!0,internalType:"address",name:"poolAddress",type:"address"},{indexed:!1,internalType:"enum IVault.PoolSpecialization",name:"specialization",type:"uint8"}],name:"PoolRegistered",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"relayer",type:"address"},{indexed:!0,internalType:"address",name:"sender",type:"address"},{indexed:!1,internalType:"bool",name:"approved",type:"bool"}],name:"RelayerApprovalChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"poolId",type:"bytes32"},{indexed:!0,internalType:"contract IERC20",name:"tokenIn",type:"address"},{indexed:!0,internalType:"contract IERC20",name:"tokenOut",type:"address"},{indexed:!1,internalType:"uint256",name:"amountIn",type:"uint256"},{indexed:!1,internalType:"uint256",name:"amountOut",type:"uint256"}],name:"Swap",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"poolId",type:"bytes32"},{indexed:!1,internalType:"contract IERC20[]",name:"tokens",type:"address[]"}],name:"TokensDeregistered",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"poolId",type:"bytes32"},{indexed:!1,internalType:"contract IERC20[]",name:"tokens",type:"address[]"},{indexed:!1,internalType:"address[]",name:"assetManagers",type:"address[]"}],name:"TokensRegistered",type:"event"},{inputs:[],name:"WETH",outputs:[{internalType:"contract IWETH",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"enum IVault.SwapKind",name:"kind",type:"uint8"},{components:[{internalType:"bytes32",name:"poolId",type:"bytes32"},{internalType:"uint256",name:"assetInIndex",type:"uint256"},{internalType:"uint256",name:"assetOutIndex",type:"uint256"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"bytes",name:"userData",type:"bytes"}],internalType:"struct IVault.BatchSwapStep[]",name:"swaps",type:"tuple[]"},{internalType:"contract IAsset[]",name:"assets",type:"address[]"},{components:[{internalType:"address",name:"sender",type:"address"},{internalType:"bool",name:"fromInternalBalance",type:"bool"},{internalType:"address payable",name:"recipient",type:"address"},{internalType:"bool",name:"toInternalBalance",type:"bool"}],internalType:"struct IVault.FundManagement",name:"funds",type:"tuple"},{internalType:"int256[]",name:"limits",type:"int256[]"},{internalType:"uint256",name:"deadline",type:"uint256"}],name:"batchSwap",outputs:[{internalType:"int256[]",name:"assetDeltas",type:"int256[]"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes32",name:"poolId",type:"bytes32"},{internalType:"contract IERC20[]",name:"tokens",type:"address[]"}],name:"deregisterTokens",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"poolId",type:"bytes32"},{internalType:"address",name:"sender",type:"address"},{internalType:"address payable",name:"recipient",type:"address"},{components:[{internalType:"contract IAsset[]",name:"assets",type:"address[]"},{internalType:"uint256[]",name:"minAmountsOut",type:"uint256[]"},{internalType:"bytes",name:"userData",type:"bytes"},{internalType:"bool",name:"toInternalBalance",type:"bool"}],internalType:"struct IVault.ExitPoolRequest",name:"request",type:"tuple"}],name:"exitPool",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"contract IFlashLoanRecipient",name:"recipient",type:"address"},{internalType:"contract IERC20[]",name:"tokens",type:"address[]"},{internalType:"uint256[]",name:"amounts",type:"uint256[]"},{internalType:"bytes",name:"userData",type:"bytes"}],name:"flashLoan",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"selector",type:"bytes4"}],name:"getActionId",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"getAuthorizer",outputs:[{internalType:"contract IAuthorizer",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getDomainSeparator",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"user",type:"address"},{internalType:"contract IERC20[]",name:"tokens",type:"address[]"}],name:"getInternalBalance",outputs:[{internalType:"uint256[]",name:"balances",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"user",type:"address"}],name:"getNextNonce",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"getPausedState",outputs:[{internalType:"bool",name:"paused",type:"bool"},{internalType:"uint256",name:"pauseWindowEndTime",type:"uint256"},{internalType:"uint256",name:"bufferPeriodEndTime",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"poolId",type:"bytes32"}],name:"getPool",outputs:[{internalType:"address",name:"",type:"address"},{internalType:"enum IVault.PoolSpecialization",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"poolId",type:"bytes32"},{internalType:"contract IERC20",name:"token",type:"address"}],name:"getPoolTokenInfo",outputs:[{internalType:"uint256",name:"cash",type:"uint256"},{internalType:"uint256",name:"managed",type:"uint256"},{internalType:"uint256",name:"lastChangeBlock",type:"uint256"},{internalType:"address",name:"assetManager",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"poolId",type:"bytes32"}],name:"getPoolTokens",outputs:[{internalType:"contract IERC20[]",name:"tokens",type:"address[]"},{internalType:"uint256[]",name:"balances",type:"uint256[]"},{internalType:"uint256",name:"lastChangeBlock",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"getProtocolFeesCollector",outputs:[{internalType:"contract ProtocolFeesCollector",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"user",type:"address"},{internalType:"address",name:"relayer",type:"address"}],name:"hasApprovedRelayer",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"poolId",type:"bytes32"},{internalType:"address",name:"sender",type:"address"},{internalType:"address",name:"recipient",type:"address"},{components:[{internalType:"contract IAsset[]",name:"assets",type:"address[]"},{internalType:"uint256[]",name:"maxAmountsIn",type:"uint256[]"},{internalType:"bytes",name:"userData",type:"bytes"},{internalType:"bool",name:"fromInternalBalance",type:"bool"}],internalType:"struct IVault.JoinPoolRequest",name:"request",type:"tuple"}],name:"joinPool",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{components:[{internalType:"enum IVault.PoolBalanceOpKind",name:"kind",type:"uint8"},{internalType:"bytes32",name:"poolId",type:"bytes32"},{internalType:"contract IERC20",name:"token",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],internalType:"struct IVault.PoolBalanceOp[]",name:"ops",type:"tuple[]"}],name:"managePoolBalance",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"enum IVault.UserBalanceOpKind",name:"kind",type:"uint8"},{internalType:"contract IAsset",name:"asset",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address",name:"sender",type:"address"},{internalType:"address payable",name:"recipient",type:"address"}],internalType:"struct IVault.UserBalanceOp[]",name:"ops",type:"tuple[]"}],name:"manageUserBalance",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"enum IVault.SwapKind",name:"kind",type:"uint8"},{components:[{internalType:"bytes32",name:"poolId",type:"bytes32"},{internalType:"uint256",name:"assetInIndex",type:"uint256"},{internalType:"uint256",name:"assetOutIndex",type:"uint256"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"bytes",name:"userData",type:"bytes"}],internalType:"struct IVault.BatchSwapStep[]",name:"swaps",type:"tuple[]"},{internalType:"contract IAsset[]",name:"assets",type:"address[]"},{components:[{internalType:"address",name:"sender",type:"address"},{internalType:"bool",name:"fromInternalBalance",type:"bool"},{internalType:"address payable",name:"recipient",type:"address"},{internalType:"bool",name:"toInternalBalance",type:"bool"}],internalType:"struct IVault.FundManagement",name:"funds",type:"tuple"}],name:"queryBatchSwap",outputs:[{internalType:"int256[]",name:"",type:"int256[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"enum IVault.PoolSpecialization",name:"specialization",type:"uint8"}],name:"registerPool",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"poolId",type:"bytes32"},{internalType:"contract IERC20[]",name:"tokens",type:"address[]"},{internalType:"address[]",name:"assetManagers",type:"address[]"}],name:"registerTokens",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"contract IAuthorizer",name:"newAuthorizer",type:"address"}],name:"setAuthorizer",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bool",name:"paused",type:"bool"}],name:"setPaused",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"sender",type:"address"},{internalType:"address",name:"relayer",type:"address"},{internalType:"bool",name:"approved",type:"bool"}],name:"setRelayerApproval",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"bytes32",name:"poolId",type:"bytes32"},{internalType:"enum IVault.SwapKind",name:"kind",type:"uint8"},{internalType:"contract IAsset",name:"assetIn",type:"address"},{internalType:"contract IAsset",name:"assetOut",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"bytes",name:"userData",type:"bytes"}],internalType:"struct IVault.SingleSwap",name:"singleSwap",type:"tuple"},{components:[{internalType:"address",name:"sender",type:"address"},{internalType:"bool",name:"fromInternalBalance",type:"bool"},{internalType:"address payable",name:"recipient",type:"address"},{internalType:"bool",name:"toInternalBalance",type:"bool"}],internalType:"struct IVault.FundManagement",name:"funds",type:"tuple"},{internalType:"uint256",name:"limit",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"}],name:"swap",outputs:[{internalType:"uint256",name:"amountCalculated",type:"uint256"}],stateMutability:"payable",type:"function"},{stateMutability:"payable",type:"receive"}];class be{static async fromPaths(t,e,n){const i=[];for(const e of t){const t=e.inputAmount,n=e.outputAmount;i.push({path:e,inputAmount:t,outputAmount:n})}return new be({paths:i,swapKind:e,swapAmount:n})}constructor({paths:t,swapKind:e,swapAmount:n}){if(0===t.length)throw new Error("Invalid swap: must contain at least 1 path.");this.paths=t,this.swapKind=e,this.isNativeSwap=n.token.isNative,this.isBatchSwap=t.length>1||t[0].path.pools.length>2,this.assets=[...new Set(t.map((t=>t.path.tokens)).flat().map((t=>t.address)))];const i=[];if(this.swapKind===Bt.GivenIn?t.map((t=>{t.path.pools.map(((e,n)=>{i.push({poolId:e.id,assetInIndex:this.assets.indexOf(t.path.tokens[n].address),assetOutIndex:this.assets.indexOf(t.path.tokens[n+1].address),amount:0===n?t.inputAmount.amount.toString():"0",userData:E})}))})):t.map((t=>{const e=[...t.path.pools].reverse(),n=[...t.path.tokens].reverse();e.map(((e,r)=>{i.push({poolId:e.id,assetInIndex:this.assets.indexOf(n[r+1].address),assetOutIndex:this.assets.indexOf(n[r].address),amount:0===r?t.outputAmount.amount.toString():"0",userData:E})}))})),this.isNativeSwap){const t=this.assets.findIndex((t=>t===n.token.wrapped));this.assets[t]=c}this.swaps=i}get inputAmount(){if(!this.paths.every((t=>t.inputAmount.token.isEqual(this.paths[0].inputAmount.token))))throw new Error("Input amount can only be calculated if all paths have the same input token");return this.paths.map((t=>t.inputAmount)).reduce(((t,e)=>t.add(e)))}get outputAmount(){if(!this.paths.every((t=>t.outputAmount.token.isEqual(this.paths[0].outputAmount.token))))throw new Error("Output amount can only be calculated if all paths have the same output token");return this.paths.map((t=>t.outputAmount)).reduce(((t,e)=>t.add(e)))}async query(t,e){const n=new ve("0xBA12222222228d8Ba445958a75a0704d566BF2C8",Te,t),i=await n.callStatic.queryBatchSwap(this.swapKind,this.swaps,this.assets,b,{blockTag:e});return this.swapKind===Bt.GivenIn?Ee.fromRawAmount(this.paths[0].outputAmount.token,i[this.assets.indexOf(this.paths[0].outputAmount.token.address)].abs()):Ee.fromRawAmount(this.paths[0].inputAmount.token,i[this.assets.indexOf(this.paths[0].inputAmount.token.address)].abs())}callData(){return new t(Te).encodeFunctionData("queryBatchSwap",[this.swapKind,this.swaps,this.assets,b])}}class Ee{static fromRawAmount(t,e){return new Ee(t,e)}static fromHumanAmount(t,e){const n=ft(e,t.decimals);return new Ee(t,n)}static fromScale18Amount(t,e,n){const i=BigInt(10)**BigInt(18-t.decimals),r=n?1n+(BigInt(e)-1n)/i:BigInt(e)/i;return new Ee(t,r)}constructor(t,e){this.decimalScale=BigInt(10)**BigInt(t.decimals),this.token=t,this.amount=BigInt(e),this.scalar=BigInt(10)**BigInt(18-t.decimals),this.scale18=this.amount*this.scalar}add(t){return new Ee(this.token,this.amount+t.amount)}sub(t){return new Ee(this.token,this.amount-t.amount)}mulUpFixed(t){const e=(this.amount*t-1n)/gt+1n;return new Ee(this.token,e)}mulDownFixed(t){const e=this.amount*t/gt;return new Ee(this.token,e)}divUpFixed(t){const e=(this.amount*gt+t-1n)/t;return new Ee(this.token,e)}divDownFixed(t){const e=this.amount*gt/t;return new Ee(this.token,e)}toSignificant(t=6){return new u(this.amount.toString()).div(new u(this.decimalScale.toString())).toDecimalPlaces(t).toString()}}class Me{constructor(){this.maxPathsPerTokenPair=2,this.nodes=new Map,this.edges=new Map,this.poolAddressMap=new Map}buildGraph({pools:t,maxPathsPerTokenPair:e=2}){this.poolAddressMap=new Map,this.nodes=new Map,this.edges=new Map,this.maxPathsPerTokenPair=e,this.buildPoolAddressMap(t),this.addAllTokensAsGraphNodes(t),this.addTokenPairsAsGraphEdges({pools:t,maxPathsPerTokenPair:e})}getCandidatePaths({tokenIn:t,tokenOut:e,graphTraversalConfig:n}){const i={maxDepth:7,maxNonBoostedPathDepth:3,maxNonBoostedHopTokensInBoostedPath:1,approxPathsToReturn:5,pathSearchTimeoutMs:1e3,...n},r=this.findAllValidTokenPaths({token:t.wrapped,tokenIn:t.wrapped,tokenOut:e.wrapped,config:i,tokenPath:[t.wrapped]}).sort(((t,e)=>t.length<e.length?-1:1)),s=[],o=[],a=Date.now();for(;s.length<i.approxPathsToReturn&&Date.now()-a<i.pathSearchTimeoutMs;)for(let t=0;t<this.maxPathsPerTokenPair;t++)for(let e=0;e<r.length;e++){const n=this.expandTokenPath({tokenPath:r[e],tokenPairIndex:t});this.isValidPath({path:n,seenPoolAddresses:[],selectedPathIds:o,config:i})&&(o.push(this.getIdForPath(n)),s.push(n))}return this.sortAndFilterPaths(s).map((t=>{const e=[...t.map((t=>t.tokenOut))];return e.unshift(t[0].tokenIn),{tokens:e,pools:t.map((t=>t.pool))}}))}sortAndFilterPaths(t){const e=t.map((t=>{let e=0n;try{e=this.getLimitAmountSwapForPath(t,Bt.GivenIn)}catch{}return{path:t,limit:e}})).sort(((t,e)=>t.limit<e.limit?1:-1)),n=[];for(const{path:t}of e){let e=[],i=!0;for(const n of t)if(e.includes(n.pool.id)){i=!1;break}i&&(n.push(t),e=[...e,...t.map((t=>t.pool.id))])}return n}buildPoolAddressMap(t){for(const e of t)this.poolAddressMap.set(e.address,e)}addAllTokensAsGraphNodes(t){for(const e of t)for(const t of e.tokens){const e=t.token;this.nodes.has(e.wrapped)||this.addNode(e)}}addTokenPairsAsGraphEdges({pools:t,maxPathsPerTokenPair:e}){for(const n of t)for(let t=0;t<n.tokens.length-1;t++)for(let i=t+1;i<n.tokens.length;i++){const r=n.tokens[t].token,s=n.tokens[i].token;this.addEdge({edgeProps:{pool:n,tokenIn:r,tokenOut:s,normalizedLiquidity:n.getNormalizedLiquidity(r,s)},maxPathsPerTokenPair:e}),this.addEdge({edgeProps:{pool:n,tokenIn:s,tokenOut:r,normalizedLiquidity:n.getNormalizedLiquidity(s,r)},maxPathsPerTokenPair:e})}}addNode(t){this.nodes.set(t.wrapped,{isPhantomBpt:!!this.poolAddressMap[t.wrapped]}),this.edges.has(t.wrapped)||this.edges.set(t.wrapped,new Map)}getConnectedVertices(t){const e=[],n=this.edges.get(t)||[];for(const[t]of n)e.push(t);return e}addEdge({edgeProps:t,maxPathsPerTokenPair:e}){const n=this.nodes.get(t.tokenIn.wrapped),i=this.nodes.get(t.tokenOut.wrapped),r=this.edges.get(t.tokenIn.wrapped);if(!n||!i||!r)throw new Error("Attempting to add invalid edge");const s=n.isPhantomBpt||i.isPhantomBpt,o=[...r.get(t.tokenOut.wrapped)||[],t].sort(((t,e)=>t.normalizedLiquidity>e.normalizedLiquidity?-1:1));r.set(t.tokenOut.wrapped,o.length>e&&!s?o.slice(0,2):o)}findAllValidTokenPaths(t){const e=[];return this.traverseBfs({...t,callback:t=>{e.push(t)}}),e}expandTokenPath({tokenPath:t,tokenPairIndex:e}){const n=[];for(let i=0;i<t.length-1;i++){const r=this.edges.get(t[i])?.get(t[i+1]);if(!r||0===r.length)throw new Error(`Missing edge for pair ${t[i]} -> ${t[i+1]}`);n.push(r[e]||r[0])}return n}traverseBfs({token:t,tokenIn:e,tokenOut:n,tokenPath:i,callback:r,config:s}){const o=this.getConnectedVertices(t);for(const t of o){const o=this.isValidTokenPath({tokenPath:[...i,t],tokenIn:e,tokenOut:n,config:s});o&&t===n?r([...i,t]):o&&!i.includes(t)&&this.traverseBfs({tokenPath:[...i,t],token:t,tokenIn:e,tokenOut:n,callback:r,config:s})}}isValidTokenPath({tokenPath:t,config:e,tokenIn:n,tokenOut:i}){const r=t[t.length-1]===i,s=t.filter((t=>t!==n&&t!==i)).filter((t=>!this.poolAddressMap.has(t))).length,o=t.filter((t=>this.poolAddressMap.has(t))).length>0;return!(t.length>e.maxDepth)&&(!(o&&s>e.maxNonBoostedHopTokensInBoostedPath)&&(!(t.length>e.maxNonBoostedPathDepth&&s>e.maxNonBoostedHopTokensInBoostedPath)&&!(r&&!o&&t.length>e.maxNonBoostedPathDepth)))}isValidPath({path:t,seenPoolAddresses:e,selectedPathIds:n,config:i}){const r=t.map((t=>t.pool.id)),s=[...new Set(r)];if(i.poolIdsToInclude)for(const t of r)if(!i.poolIdsToInclude.includes(t))return!1;if(s.length!==r.length)return!1;for(const n of t)if(e.includes(n.pool.address))return!1;return!n.includes(this.getIdForPath(t))}getIdForPath(t){let e="";for(const n of t)e.length>0&&(e+="_"),e+=`${n.pool.id}-${n.tokenIn}-${n.tokenOut}`;return e}filterVolatilePools(t){const e=[];for(const n of t)this.poolAddressMap.get(n)?.poolType===Rt.Weighted&&e.push(n);return e}getLimitAmountSwapForPath(t,e){let n=t[t.length-1].pool.getLimitAmountSwap(t[t.length-1].tokenIn,t[t.length-1].tokenOut,e);for(let e=t.length-2;e>=0;e--){const i=t[e].pool.getLimitAmountSwap(t[e].tokenIn,t[e].tokenOut,Bt.GivenIn);if(t[e].pool.getLimitAmountSwap(t[e].tokenIn,t[e].tokenOut,Bt.GivenOut)<=n)n=i;else{const r=t[e].pool.swapGivenOut(t[e].tokenIn,t[e].tokenOut,Ee.fromRawAmount(t[e].tokenOut,n)).amount;n=r>i?i:r}}return n}}class ke{constructor(){this.pathGraph=new Me}getCandidatePaths(t,e,n,i,r){this.pathGraph.buildGraph({pools:i});return this.pathGraph.getCandidatePaths({tokenIn:t,tokenOut:e,graphTraversalConfig:r})}async getBestPaths(t,e,n){if(0===t.length)throw new Error("No potential swap paths provided");const i=[];let r;t.forEach((t=>{try{i.push(new Dt(t.tokens,t.pools,n))}catch{return}})),e===Bt.GivenIn?(r=i.map((t=>({item:t,value:Number(t.outputAmount.amount)}))),r.sort(((t,e)=>e.value-t.value))):(r=i.map((t=>({item:t,value:Number(t.inputAmount.amount)}))),r.sort(((t,e)=>t.value-e.value)));const s=r.map((t=>t.item));if(1===s.length)return await be.fromPaths(s,e,n);const o=n.mulDownFixed(gt/2n),a=n.sub(o),l=new Dt(s[0].tokens,s[0].pools,o),h=new Dt(s[1].tokens,s[1].pools,a),u=await be.fromPaths(s.slice(0,1),e,n),p=await be.fromPaths([l,h],e,n);return e===Bt.GivenIn?u.outputAmount.amount>p.outputAmount.amount?u:p:u.inputAmount.amount<p.inputAmount.amount?u:p}}class Ie extends Ee{constructor(t,e,n,i){super(t,e),this.weight=BigInt(n),this.index=i}}class Pe{static fromRawPool(t){const e=[];for(const n of t.tokens){if(!n.weight)throw new Error("Weighted pool token does not have a weight");const t=new d(1,n.address,n.decimals,n.symbol,n.name),i=Ee.fromHumanAmount(t,n.balance);e.push(new Ie(t,i.amount,mt(n.weight),n.index))}return new Pe(t.id,t.poolTypeVersion,mt(t.swapFee),e)}constructor(t,e,n,i){this.poolType=Rt.Weighted,this.MAX_IN_RATIO=300000000000000000n,this.MAX_OUT_RATIO=300000000000000000n,this.id=t,this.poolTypeVersion=e,this.address=kt(t),this.swapFee=n,this.tokens=i,this.tokenMap=new Map(i.map((t=>[t.token.address,t])))}getNormalizedLiquidity(t,e){const{tIn:n,tOut:i}=this.getRequiredTokenPair(t,e);return n.amount*i.weight/(n.weight+i.weight)}getLimitAmountSwap(t,e,n){const{tIn:i,tOut:r}=this.getRequiredTokenPair(t,e);return n===Bt.GivenIn?i.amount*this.MAX_IN_RATIO/gt:r.amount*this.MAX_OUT_RATIO/gt}swapGivenIn(t,e,n){const{tIn:i,tOut:r}=this.getRequiredTokenPair(t,e);if(n.amount>this.getLimitAmountSwap(t,e,Bt.GivenIn))throw new Error("Swap amount exceeds the pool limit");const s=this.subtractSwapFeeAmount(n),o=function(t,e,n,i,r,s){const o=t+r,a=Et.divUpFixed(t,o),l=Et.divDownFixed(e,i),h=Et.powUpFixed(a,l,s);return Et.mulDownFixed(n,Et.complementFixed(h))}(i.scale18,i.weight,r.scale18,r.weight,s.scale18,this.poolTypeVersion);return Ee.fromScale18Amount(e,o)}swapGivenOut(t,e,n){const{tIn:i,tOut:r}=this.getRequiredTokenPair(t,e);if(n.amount>this.getLimitAmountSwap(t,e,Bt.GivenOut))throw new Error("Swap amount exceeds the pool limit");const s=function(t,e,n,i,r,s){const o=Et.divUpFixed(n,n-r),a=Et.divUpFixed(i,e),l=Et.powUpFixed(o,a,s)-gt;return Et.mulUpFixed(t,l)}(i.scale18,i.weight,r.scale18,r.weight,n.scale18,this.poolTypeVersion),o=Ee.fromScale18Amount(t,s,!0);return this.addSwapFeeAmount(o)}subtractSwapFeeAmount(t){const e=t.mulUpFixed(this.swapFee);return t.sub(e)}addSwapFeeAmount(t){return t.divUpFixed(Et.complementFixed(this.swapFee))}getRequiredTokenPair(t,e){const n=this.tokenMap.get(t.address),i=this.tokenMap.get(e.address);if(!n||!i)throw new Error("Pool does not contain the tokens provided");return{tIn:n,tOut:i}}}class xe{isPoolForFactory(t){return"Weighted"===t.poolType}create(t){return Pe.fromRawPool(t)}}const _e=1000n;function Ae(t,e,n){let i=0n;const r=e.length;for(let t=0;t<r;t++)i+=e[t];if(0n==i)return 0n;let s,o=i;const a=t*BigInt(r);for(let t=0;t<255;t++){let t=o;for(let i=0;i<r;i++)t=n?Et.divUp(t*o,e[i]*BigInt(r)):t*o/(e[i]*BigInt(r));if(s=o,o=n?Et.divUp((a*i/_e+t*BigInt(r))*o,Et.divUp((a-_e)*o,_e)+(BigInt(r)+1n)*t):(a*i/_e+t*BigInt(r))*o/((a-_e)*o/_e+(BigInt(r)+1n)*t),o>s){if(o-s<=1n)return o}else if(s-o<=1n)return o}throw new Error("Errors.STABLE_INVARIANT_DIDNT_CONVERGE")}function Ne(t,e,n,i,r,s){e[n]=e[n]+r;const o=Oe(t,e,s,i);return e[n]=e[n]-r,e[i]-o-1n}function Fe(t,e,n,i,r,s){e[i]=e[i]-r;const o=Oe(t,e,s,n);return e[i]=e[i]-r,o-e[n]+1n}function Oe(t,e,n,i){const r=t*BigInt(e.length);let s=e[0],o=e[0]*BigInt(e.length);for(let t=1;t<e.length;t++)o=o*e[t]*BigInt(e.length)/n,s+=e[t];s-=e[i];const a=n*n,l=Et.divUp(a,r*o)*_e*e[i],h=s+n/r*_e;let u=0n,p=Et.divUp(a+l,n+h);for(let t=0;t<255;t++)if(u=p,p=Et.divUp(p*p+l,2n*p+h-n),p>u){if(p-u<=1n)return p}else if(u-p<=1n)return p;throw new Error("Errors.STABLE_GET_BALANCE_DIDNT_CONVERGE")}class Se extends Ee{constructor(t,e,n,i){super(t,e),this.rate=BigInt(n),this.scale18=this.amount*this.scalar*this.rate/gt,this.index=i}}class Re extends Ee{constructor(t,e,n){super(t,e),this.rate=gt,this.virtualBalance=f-this.amount,this.index=n}}class Be{static fromRawPool(t){const e=[];for(const n of t.tokens){if(!n.priceRate)throw new Error("Stable pool token does not have a price rate");const i=new d(1,n.address,n.decimals,n.symbol,n.name),r=Ee.fromHumanAmount(i,n.balance);n.address===t.address?e.push(new Re(i,r.amount,n.index)):e.push(new Se(i,r.amount,mt(n.priceRate),n.index))}const n=mt(t.totalShares),i=1000n*BigInt(t.amp);return new Be(t.id,i,mt(t.swapFee),e,n)}constructor(t,e,n,i,r){this.poolType=Rt.ComposableStable,this.id=t,this.address=kt(t),this.amp=e,this.swapFee=n,this.totalShares=r,this.tokens=i.sort(((t,e)=>t.index-e.index)),this.tokenMap=new Map(this.tokens.map((t=>[t.token.address,t]))),this.tokenIndexMap=new Map(this.tokens.map((t=>[t.token.address,t.index]))),this.bptIndex=this.tokenIndexMap.get(this.address)||-1,this.tokensNoBpt=[...this.tokens],this.tokensNoBpt.splice(this.bptIndex,1),this.tokenNoBptIndexMap=new Map(this.tokensNoBpt.map((t=>[t.token.address,t.index>this.bptIndex?t.index-1:t.index])))}getNormalizedLiquidity(t,e){const n=this.tokenMap.get(t.address),i=this.tokenMap.get(e.address);if(!n||!i)throw new Error("Pool does not contain the tokens provided");return i.amount*this.amp}swapGivenIn(t,e,n){const i=this.tokenIndexMap.get(t.address),r=this.tokenIndexMap.get(e.address);if("number"!=typeof i||"number"!=typeof r)throw new Error("Pool does not contain the tokens provided");if(n.scale18>this.tokens[i].scale18)throw new Error("Swap amount exceeds the pool limit");const s=this.tokenNoBptIndexMap.get(t.address),o=this.tokenNoBptIndexMap.get(e.address),a=this.tokensNoBpt.map((t=>t.scale18)),l=Ae(this.amp,a);let h;if(t.isEqual(this.tokens[this.bptIndex].token)){if("number"!=typeof o)throw new Error("Pool does not contain the tokens provided");const t=n.mulDownFixed(this.tokens[i].rate);h=function(t,e,n,i,r,s,o){const a=Oe(t,e,Et.mulUpFixed(Et.divUpFixed(r-i,r),s),n),l=e[n]-a;let h=0n;for(let t=0;t<e.length;t++)h+=e[t];const u=Et.divDownFixed(e[n],h),p=Et.complementFixed(u),d=Et.mulUpFixed(l,p);return l-d+Et.mulDownFixed(d,gt-o)}(this.amp,[...a],o,t.scale18,this.totalShares,l,this.swapFee)}else if(e.isEqual(this.tokens[this.bptIndex].token)){const t=new Array(this.tokensNoBpt.length).fill(0n);if("number"!=typeof s)throw new Error("Pool does not contain the tokens provided");const e=n.mulDownFixed(this.tokens[i].rate);t[s]=e.scale18,h=function(t,e,n,i,r,s){let o=0n;for(let t=0;t<e.length;t++)o+=e[t];const a=new Array(n.length);let l=0n;for(let t=0;t<e.length;t++){const i=Et.divDownFixed(e[t],o);a[t]=Et.divDownFixed(e[t]+n[t],e[t]),l+=Et.mulDownFixed(a[t],i)}const h=new Array(e.length);for(let t=0;t<e.length;t++){let i;if(a[t]>l){const r=Et.mulDownFixed(e[t],l-gt),o=n[t]-r;i=r+Et.mulDownFixed(o,gt-s)}else i=n[t];h[t]=e[t]+i}const u=Ae(t,h),p=Et.divDownFixed(u,r);return p>gt?Et.mulDownFixed(i,p-gt):0n}(this.amp,[...a],t,this.totalShares,l,this.swapFee)}else{const t=this.subtractSwapFeeAmount(n).mulDownFixed(this.tokens[i].rate);if("number"!=typeof s||"number"!=typeof o)throw new Error("Pool does not contain the tokens provided");h=Ne(this.amp,[...a],s,o,t.scale18,l)}return Ee.fromScale18Amount(e,h).divDownFixed(this.tokens[r].rate)}swapGivenOut(t,e,n){const i=this.tokenIndexMap.get(t.address),r=this.tokenIndexMap.get(e.address);if("number"!=typeof i||"number"!=typeof r)throw new Error("Pool does not contain the tokens provided");if(n.scale18>this.tokens[r].scale18)throw new Error("Swap amount exceeds the pool limit");const s=this.tokenNoBptIndexMap.get(t.address),o=this.tokenNoBptIndexMap.get(e.address),a=n.mulDownFixed(this.tokens[r].rate),l=this.tokensNoBpt.map((t=>t.scale18)),h=Ae(this.amp,l);let u;if(t.isEqual(this.tokens[this.bptIndex].token)){if("number"!=typeof o)throw new Error("Pool does not contain the tokens provided");const e=new Array(this.tokensNoBpt.length).fill(0n);e[o]=a.scale18;const n=function(t,e,n,i,r,s){let o=0n;for(let t=0;t<e.length;t++)o+=e[t];const a=new Array(n.length);let l=0n;for(let t=0;t<e.length;t++){const i=Et.divUpFixed(e[t],o);a[t]=e[t]-Et.divUpFixed(n[t],e[t]),l+=Et.mulUpFixed(a[t],i)}const h=new Array(e.length);for(let t=0;t<e.length;t++){let i;if(l>a[t]){const r=Et.mulDownFixed(e[t],Et.complementFixed(l)),o=n[t]-r;i=r+Et.divUpFixed(o,gt-s)}else i=n[t];h[t]=e[t]-i}const u=Ae(t,h),p=Et.divDownFixed(r,u);return Et.mulUpFixed(i,Et.complementFixed(p))}(this.amp,[...l],e,this.totalShares,h,this.swapFee);u=Ee.fromScale18Amount(t,n,!0).divDownFixed(this.tokens[i].rate)}else if(e.isEqual(this.tokens[this.bptIndex].token)){if("number"!=typeof s)throw new Error("Pool does not contain the tokens provided");const e=function(t,e,n,i,r,s,o){const a=Oe(t,e,Et.mulUpFixed(Et.divUpFixed(r+i,r),s),n)-e[n];let l=0n;for(let t=0;t<e.length;t++)l+=e[t];const h=Et.divDownFixed(e[n],l),u=Et.complementFixed(h),p=Et.mulUpFixed(a,u);return a-p+Et.divUpFixed(p,gt-o)}(this.amp,[...l],s,a.scale18,this.totalShares,h,this.swapFee);u=Ee.fromScale18Amount(t,e,!0).divDownFixed(this.tokens[i].rate)}else{if("number"!=typeof s||"number"!=typeof o)throw new Error("Pool does not contain the tokens provided");const e=Fe(this.amp,[...l],s,o,a.scale18,h),n=Ee.fromScale18Amount(t,e,!0);u=this.addSwapFeeAmount(n).divDownFixed(this.tokens[i].rate)}return u}subtractSwapFeeAmount(t){const e=t.mulUpFixed(this.swapFee);return t.sub(e)}addSwapFeeAmount(t){return t.divUpFixed(Et.complementFixed(this.swapFee))}getLimitAmountSwap(t,e,n){const i=this.tokenMap.get(t.address),r=this.tokenMap.get(e.address);if(!i||!r)throw new Error("Pool does not contain the tokens provided");return n===Bt.GivenIn?i.amount*Tt/i.rate:r.amount*Tt/r.rate}}class Ue{isPoolForFactory(t){return"ComposableStable"===t.poolType}create(t){return Be.fromRawPool(t)}}class De extends Ee{constructor(t,e,n,i){super(t,e),this.rate=BigInt(n),this.scale18=this.amount*this.scalar*this.rate/gt,this.index=i}}class Le{static fromRawPool(t){const e=[];for(const n of t.tokens){if(!n.priceRate)throw new Error("Meta Stable pool token does not have a price rate");const t=new d(1,n.address,n.decimals,n.symbol,n.name),i=Ee.fromHumanAmount(t,n.balance);e.push(new De(t,i.amount,mt(n.priceRate),n.index))}const n=1000n*BigInt(t.amp);return new Le(t.id,n,mt(t.swapFee),e)}constructor(t,e,n,i){this.poolType=Rt.MetaStable,this.id=t,this.address=kt(t),this.amp=e,this.swapFee=n,this.tokens=i.sort(((t,e)=>t.index-e.index)),this.tokenMap=new Map(this.tokens.map((t=>[t.token.address,t]))),this.tokenIndexMap=new Map(this.tokens.map((t=>[t.token.address,t.index])))}getNormalizedLiquidity(t,e){const n=this.tokenMap.get(t.address),i=this.tokenMap.get(e.address);if(!n||!i)throw new Error("Pool does not contain the tokens provided");return i.amount*this.amp}swapGivenIn(t,e,n){const i=this.tokenIndexMap.get(t.address),r=this.tokenIndexMap.get(e.address);if("number"!=typeof i||"number"!=typeof r)throw new Error("Pool does not contain the tokens provided");if(n.amount>this.tokens[i].amount)throw new Error("Swap amount exceeds the pool limit");const s=this.subtractSwapFeeAmount(n).mulDownFixed(this.tokens[i].rate),o=this.tokens.map((t=>t.scale18)),a=Ae(this.amp,[...o],!0),l=Ne(this.amp,[...o],i,r,s.scale18,a);return Ee.fromScale18Amount(e,l).divDownFixed(this.tokens[r].rate)}swapGivenOut(t,e,n){const i=this.tokenIndexMap.get(t.address),r=this.tokenIndexMap.get(e.address);if("number"!=typeof i||"number"!=typeof r)throw new Error("Pool does not contain the tokens provided");if(n.amount>this.tokens[r].amount)throw new Error("Swap amount exceeds the pool limit");const s=n.mulDownFixed(this.tokens[r].rate),o=this.tokens.map((t=>t.scale18)),a=Ae(this.amp,o,!0),l=Fe(this.amp,[...o],i,r,s.scale18,a),h=Ee.fromScale18Amount(t,l,!0);return this.addSwapFeeAmount(h).divDownFixed(this.tokens[i].rate)}subtractSwapFeeAmount(t){const e=t.mulUpFixed(this.swapFee);return t.sub(e)}addSwapFeeAmount(t){return t.divUpFixed(Et.complementFixed(this.swapFee))}getLimitAmountSwap(t,e,n){const i=this.tokenMap.get(t.address),r=this.tokenMap.get(e.address);if(!i||!r)throw new Error("Pool does not contain the tokens provided");return n===Bt.GivenIn?i.amount*Tt/i.rate:r.amount*Tt/r.rate}}class Ce{isPoolForFactory(t){return"MetaStable"===t.poolType}create(t){return Le.fromRawPool(t)}}function Ge(t,e){return t+e}function qe(t,e){if(t<e.lowerTarget){return t-Et.mulDownFixed(e.lowerTarget-t,e.fee)}if(t<=e.upperTarget)return t;return t-Et.mulDownFixed(t-e.upperTarget,e.fee)}function We(t,e){return t<e.lowerTarget?Et.divDownFixed(t+Et.mulDownFixed(e.fee,e.lowerTarget),gt+e.fee):t<=e.upperTarget?t:Et.divDownFixed(t-Et.mulDownFixed(e.fee,e.upperTarget),gt-e.fee)}const ze=mt("1"),Ve=mt("10"),je=m-1n;class $e extends Ee{constructor(t,e,n){super(t,e),this.rate=gt,this.virtualBalance=je-this.amount,this.index=n}}class He extends Ee{constructor(t,e,n,i){super(t,e),this.rate=BigInt(n),this.scale18=this.amount*this.scalar*this.rate/gt,this.index=i}}class Ke{static fromRawPool(t){const e=t.tokens.sort(((t,e)=>t.index-e.index)),n=mt(t.swapFee),i=e[t.mainIndex],r=new d(1,i.address,i.decimals,i.symbol,i.name),s=Ee.fromHumanAmount(r,t.lowerTarget),o=Ee.fromHumanAmount(r,t.upperTarget),a=Ee.fromHumanAmount(r,i.balance),l=e[t.wrappedIndex],h=mt(l.priceRate||"1.0"),u=new d(1,l.address,l.decimals,l.symbol,l.name),p=Ee.fromHumanAmount(u,l.balance),c=new He(u,p.amount,h,l.index),m=e.findIndex((e=>e.address===t.address)),f=e[m],g=new d(1,f.address,f.decimals,f.symbol,f.name),y=Ee.fromHumanAmount(g,f.balance),w=new $e(g,y.amount,f.index),v={fee:n,rate:h,lowerTarget:s.scale18,upperTarget:o.scale18};return new Ke(t.id,t.poolTypeVersion,v,a,c,w)}constructor(t,e,n,i,r,s){this.poolType=Rt.AaveLinear,this.id=t,this.poolTypeVersion=e,this.swapFee=n.fee,this.mainToken=i,this.wrappedToken=r,this.bptToken=s,this.address=kt(t),this.params=n,this.tokens=[this.mainToken,this.wrappedToken,this.bptToken],this.tokenMap=new Map(this.tokens.map((t=>[t.token.address,t])))}getNormalizedLiquidity(t,e){const n=this.tokenMap.get(t.address),i=this.tokenMap.get(e.address);if(!n||!i)throw new Error("Pool does not contain the tokens provided");return i.amount}swapGivenIn(t,e,n){const i=this.tokenMap.get(e.address);let r;if(t.isEqual(this.mainToken.token))e.isEqual(this.wrappedToken.token)?(r=this._exactMainTokenInForWrappedOut(n),r=r.mulDownFixed(this.wrappedToken.rate)):r=this._exactMainTokenInForBptOut(n);else if(t.isEqual(this.wrappedToken.token))n=n.mulDownFixed(this.wrappedToken.rate),r=e.isEqual(this.mainToken.token)?this._exactWrappedTokenInForMainOut(n):this._exactWrappedTokenInForBptOut(n);else{if(!t.isEqual(this.bptToken.token))throw new Error("Pool does not contain the tokens provided");e.isEqual(this.mainToken.token)?r=this._exactBptInForMainOut(n):(r=this._exactBptInForWrappedOut(n),r=r.mulDownFixed(this.wrappedToken.rate))}if(r.amount>(i?.amount||0n))throw new Error("Swap amount exceeds the pool limit");return r}swapGivenOut(t,e,n){const i=this.tokenMap.get(e.address);if(n.amount>(i?.amount||0n))throw new Error("Swap amount exceeds the pool limit");let r;if(t.isEqual(this.mainToken.token))e.isEqual(this.wrappedToken.token)?(n=n.mulDownFixed(this.wrappedToken.rate),r=this._mainTokenInForExactWrappedOut(n)):r=this._mainTokenInForExactBptOut(n);else if(t.isEqual(this.wrappedToken.token))r=e.isEqual(this.mainToken.token)?this._wrappedTokenInForExactMainOut(n):this._wrappedTokenInForExactBptOut(n),r=r.mulDownFixed(this.wrappedToken.rate);else{if(!t.isEqual(this.bptToken.token))throw new Error("Pool does not contain the tokens provided");e.isEqual(this.mainToken.token)?r=this._bptInForExactMainOut(n):(n=n.mulDownFixed(this.wrappedToken.rate),r=this._bptInForExactWrappedOut(n))}return r}getLimitAmountSwap(t,e,n){const i=this.tokenMap.get(t.address),r=this.tokenMap.get(e.address);if(!i||!r)throw new Error("Pool does not contain the tokens provided");if(n===Bt.GivenIn){if(e.isEqual(this.bptToken.token))return je;{const n=Ee.fromRawAmount(e,r.amount*Tt/ze);return this.swapGivenOut(t,e,n).amount}}return e.isEqual(this.bptToken.token)?r.amount*Ve/ze:r.amount*Tt/ze}_exactMainTokenInForWrappedOut(t){const e=function(t,e,n){const i=qe(e,n);return qe(e+t,n)-i}(t.scale18,this.mainToken.scale18,this.params);return Ee.fromScale18Amount(this.wrappedToken.token,e)}_exactMainTokenInForBptOut(t){const e=function(t,e,n,i,r){if(0n==i)return qe(t,r);const s=qe(e,r);return i*(qe(e+t,r)-s)/Ge(s,n)}(t.scale18,this.mainToken.scale18,this.wrappedToken.scale18,this.bptToken.virtualBalance,this.params);return Ee.fromScale18Amount(this.bptToken.token,e)}_exactWrappedTokenInForMainOut(t){const e=(n=t.scale18,i=this.mainToken.scale18,r=this.params,i-We(qe(i,r)-n,r));var n,i,r;return Ee.fromScale18Amount(this.mainToken.token,e)}_exactWrappedTokenInForBptOut(t){const e=function(t,e,n,i,r){if(0n===i)return t;const s=qe(e,r),o=Ge(s,n);return i*Ge(s,n+t)/o-i}(t.scale18,this.mainToken.scale18,this.wrappedToken.scale18,this.bptToken.virtualBalance,this.params);return Ee.fromScale18Amount(this.bptToken.token,e)}_exactBptInForMainOut(t){const e=function(t,e,n,i,r){const s=qe(e,r);return e-We(s-Ge(s,n)*t/i,r)}(t.scale18,this.mainToken.scale18,this.wrappedToken.scale18,this.bptToken.virtualBalance,this.params);return Ee.fromScale18Amount(this.mainToken.token,e)}_exactBptInForWrappedOut(t){const e=function(t,e,n,i,r){const s=qe(e,r),o=Ge(s,n),a=i-t;return n-Et.divUpFixed(a*o/i-s,r.rate)}(t.scale18,this.mainToken.scale18,this.wrappedToken.scale18,this.bptToken.virtualBalance,this.params);return Ee.fromScale18Amount(this.wrappedToken.token,e)}_mainTokenInForExactWrappedOut(t){const e=(n=t.scale18,i=this.mainToken.scale18,r=this.params,We(qe(i,r)+Et.mulUpFixed(n,r.rate),r)-i);var n,i,r;return Ee.fromScale18Amount(this.mainToken.token,e,!0)}_mainTokenInForExactBptOut(t){const e=function(t,e,n,i,r){if(0n==i)return We(t,r);const s=qe(e,r);return We(s+Ge(s,n)*t/i,r)-e}(t.scale18,this.mainToken.scale18,this.wrappedToken.scale18,this.bptToken.virtualBalance,this.params);return Ee.fromScale18Amount(this.mainToken.token,e,!0)}_wrappedTokenInForExactMainOut(t){const e=function(t,e,n){const i=qe(e,n)-qe(e-t,n);return Et.divUpFixed(i,n.rate)}(t.scale18,this.mainToken.scale18,this.params);return Ee.fromScale18Amount(this.wrappedToken.token,e,!0)}_wrappedTokenInForExactBptOut(t){const e=function(t,e,n,i,r){if(0n==i)return Et.divUpFixed(t,r.rate);const s=qe(e,r),o=Ge(s,n),a=i+t;return Et.divUpFixed(a*o/i-s,r.rate)-n}(t.scale18,this.mainToken.scale18,this.wrappedToken.scale18,this.bptToken.virtualBalance,this.params);return Ee.fromScale18Amount(this.wrappedToken.token,e,!0)}_bptInForExactMainOut(t){const e=function(t,e,n,i,r){const s=qe(e,r);return i*(s-qe(e-t,r))/Ge(s,n)}(t.scale18,this.mainToken.scale18,this.wrappedToken.scale18,this.bptToken.virtualBalance,this.params);return Ee.fromScale18Amount(this.bptToken.token,e,!0)}_bptInForExactWrappedOut(t){const e=function(t,e,n,i,r){const s=qe(e,r),o=Ge(s,n);return i-i*Ge(s,n-t)/o}(t.scale18,this.mainToken.scale18,this.wrappedToken.scale18,this.bptToken.virtualBalance,this.params);return Ee.fromScale18Amount(this.bptToken.token,e,!0)}}class Xe{isPoolForFactory(t){return t.poolType.includes("Linear")}create(t){return Ke.fromRawPool(t)}}class Ze{constructor(t){this.poolFactories=[...t,new xe,new Ue,new Ce,new Xe]}parseRawPools(t){const e=[];for(const n of t)for(const t of this.poolFactories)if(t.isPoolForFactory(n)){e.push(t.create(n));break}return e}}class Ye{constructor(t,e,n){this.providers=t,this.enrichers=e,this.rpcUrl=n}async fetchEnrichedPools(t){const e={block:t,timestamp:await this.getTimestampForBlockNumber(t)},n=await Promise.all(this.providers.map((t=>t.getPools(e)))),i={pools:n.map((t=>t.pools)).flat(),syncedToBlockNumber:n.map((t=>t.syncedToBlockNumber||0)).sort()[0],poolsWithActiveWeightUpdates:n.map((t=>t.poolsWithActiveWeightUpdates||[])).flat(),poolsWithActiveAmpUpdates:n.map((t=>t.poolsWithActiveAmpUpdates||[])).flat()};return{rawPools:await this.enrichPools(i,e),providerData:i}}async enrichPools(t,e){let n=t.pools;const i=await Promise.all(this.enrichers.map((n=>n.fetchAdditionalPoolData(t,e))));for(let t=0;t<this.enrichers.length;t++)n=this.enrichers[t].enrichPoolsWithData(n,i[t]);return n}async getTimestampForBlockNumber(t){return t?await async function({rpcUrl:t,blockNumber:e}){const n=await i(t,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:2,method:"eth_getBlockByNumber",params:[q(e),!1]})}),r=await n.json();return Z.from(r.result.timestamp).toNumber()}({rpcUrl:this.rpcUrl,blockNumber:t}):Math.floor((new Date).getTime()/1e3)}}class Qe{constructor({chainId:t,provider:e,options:n,poolDataProviders:i,rpcUrl:r,poolDataEnrichers:s=[],customPoolFactories:o=[]}){this.pools=[],this.blockNumber=null,this.poolsProviderData=null,this.chainId=t,this.provider=e,this.router=new ke,this.poolParser=new Ze(o),this.poolDataService=new Ye(Array.isArray(i)?i:[i],Array.isArray(s)?s:[s],r)}async fetchAndCachePools(t){const{rawPools:e,providerData:n}=await this.poolDataService.fetchEnrichedPools(t);return this.pools=this.poolParser.parseRawPools(e),this.blockNumber="number"==typeof t?t:null,this.poolsProviderData=n,this.pools}async fetchAndCacheLatestPoolEnrichmentData(t){if(!this.poolsProviderData)throw new Error("fetchAndCacheLatestPoolEnrichmentData can only be called after a successful call to fetchAndCachePools");const e={block:t,timestamp:await this.poolDataService.getTimestampForBlockNumber(t)},n=await this.poolDataService.enrichPools(this.poolsProviderData,e);this.pools=this.poolParser.parseRawPools(n)}get isInitialized(){return this.pools.length>0}async getSwaps(t,e,n,i,r){const s=await this.getCandidatePaths(t,e,n,r),o=await this.router.getBestPaths(s,n,i);return{quote:n===Bt.GivenIn?o.outputAmount:o.inputAmount,swap:o}}async getCandidatePaths(t,e,n,i){return(!this.isInitialized||i?.block&&i.block!==this.blockNumber)&&await this.fetchAndCachePools(i?.block),this.router.getCandidatePaths(t,e,n,this.pools,i?.graphTraversalConfig)}static parseRawPools({pools:t,customPoolFactories:e=[]}){return new Ze(e).parseRawPools(t)}static async getSwapsWithPools({tokenIn:t,tokenOut:e,swapKind:n,swapAmount:i,pools:r,swapOptions:s}){const o=new ke,a=o.getCandidatePaths(t,e,n,r,s?.graphTraversalConfig),l=await o.getBestPaths(a,n,i);return{quote:n===Bt.GivenIn?l.outputAmount:l.inputAmount,swap:l}}}export{Tt as ALMOST_ONE,y as ChainId,b as DEFAULT_FUND_MANAGMENT,E as DEFAULT_USERDATA,T as ETH,vt as FOUR_WAD,m as MAX_UINT112,Et as MathSol,v as NATIVE_ASSETS,Ft as OnChainPoolDataEnricher,f as PREMINTED_STABLE_BPT,Ut as Path,Dt as PathWithAmount,Rt as PoolType,yt as RAY,g as SECONDS_PER_YEAR,w as SUBGRAPH_URLS,Qe as SmartOrderRouter,St as SubgraphPoolProvider,be as Swap,Bt as SwapKind,wt as TWO_WAD,d as Token,Ee as TokenAmount,gt as WAD,c as ZERO_ADDRESS,kt as getPoolAddress,xt as poolHasActualSupply,_t as poolHasPercentFee,Pt as poolHasVirtualSupply,It as poolIsLinearPool,mt as unsafeFastParseEther,ft as unsafeFastParseUnits};
//# sourceMappingURL=index.esm.js.map
